!function e(t,n,a){function o(i,l){if(!n[i]){if(!t[i]){var s="function"==typeof require&&require;if(!l&&s)return s(i,!0);if(r)return r(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[i]={exports:{}};t[i][0].call(u.exports,(function(e){return o(t[i][1][e]||e)}),u,u.exports,e,t,n,a)}return n[i].exports}for(var r="function"==typeof require&&require,i=0;i<a.length;i++)o(a[i]);return o}({1:[function(e,t,n){"use strict";function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var s=.7,c=.05,u=35,d=18,p=.33,m=1.1,h=1,y=!1,f=3,v={x1:39,y1:38,x2:712,y2:458},g={x1:0,y1:0,x2:720,y2:450},b={x1:18.98,y1:19,x2:346.56,y2:229.5},x=(v.x2-v.x1)/6,w=(v.y2-v.y1)/3,E=(i(Array(18)).map((function(e,t){return{x:t/3>>0,y:t%3}})).map((function(e){return{x:v.x1+e.x*x,y:v.y1+e.y*w}})),/разыг|розыг/gi),P=/пас|переда|смотри/gi,C=/авес|аброс|линны/g,k=/\d+:\d+/g,S=/[0-9]+/gi,T=105/(b.x2-b.x1),A={home:{TacticChanges:[0],TacticPoints:[],Points:[],AvgPoints:[],Mileage:[],PointsFull:[]},away:{TacticChanges:[0],TacticPoints:[],Points:[],AvgPoints:[],Mileage:[],PointsFull:[]}},q=[],B=[0],_={home:[],away:[]},L={home:[],away:[]};A.home.TacticPoints.push({start:0,end:1,period:0,startPoint:0,endPoint:1,team:[],ball:[],averages:[]}),A.away.TacticPoints.push({start:0,end:1,period:0,startPoint:0,endPoint:1,team:[],ball:[],averages:[]});for(var O=[],N=[[]],I=[[]],j={playersCheckboxes:[],start:0,end:125,zoneTo:0,zoneFrom:0,homePlayers:18,awayPlayers:18,high:!0,head:!0,ok:!0,failed:!0,fighted:!0},D=0;D<=d;D++){var G=function(e){var t=e||"home";A[t].Points.push([]),A[t].Mileage.push(0),A[t].AvgPoints.push({x:0,y:0}),A[t].TacticPoints[0].averages.push([{x:0,y:0}]),A[t].PointsFull.push([])};G("home"),G("away")}for(var W=1;W<=2*d;W++)N.push([]),I.push([]),j.playersCheckboxes.push(!0);var M=!1,U=!1,V="http://pefl.ru/jsonreport.php";function F(e){var t=window.location.href.match(/j\=\d+\&z\=.+/i)?window.location.href:e,n=t.indexOf("&z="),a=t.indexOf("j=");return V+"?j=".concat(t.substring(2+a,n),"&z=").concat(t.substring(3+n))}function z(e){var t,n,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g,i=e.x,l=e.y;return a?(t=Math.round(o.x2-(i-r.x1)*(o.x2-o.x1)/(r.x2-r.x1)),n=Math.round(o.y2-(l-r.y1)*(o.y2-o.y1)/(r.y2-r.y1))):(t=Math.round(o.x1+(i-r.x1)*(o.x2-o.x1)/(r.x2-r.x1)),n=Math.round(o.y1+(l-r.y1)*(o.y2-o.y1)/(r.y2-r.y1))),{x:t,y:n,value:e.value}}function R(e,t){var n=t.x-e.x,a=t.y-e.y;return Math.sqrt(n*n+a*a)}function H(e,t){var n,a,o,r,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;return t?{n:e.n,h:n.y2-e.h,w:n.x2-e.w,value:1}:{n:e.n,h:e.h,w:e.w,value:1}}(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]);return n=i,o=(a=t).w-n.w,r=a.h-n.h,Math.sqrt(o*o+r*r)}function K(e,t){var n=t.x-e.x,a=t.y-e.y;return(n<0?a<0?-180:180:0)+180*Math.atan(a/n)/Math.PI}function $(e,t){return T*R(e,t)}function Z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e||!e.mes)return 0;for(var n=String(e.mes),a=n.length,o=0,r=[],i=0;i<a;i++)"["===n[i]?o=i+1:"]"===n[i]&&o<i&&o>0&&r.push(+n.substr(o,i-o));return o?r[t-1]?+r[t-1]:0:null}function J(e,t){return e<d+1&&t<d+1||e>d&&t>d}function X(e,t){var n="G"==e.type?"red":"V"==e.type?"yellow":"Block"==e.type?"black":"B"==e.type?"black":"W"==e.type?"#FFA500":"blue",a=document.createElement("div");a.classList.add("shot");var o=t.team+"Shot";return a.classList.add(o),a.setAttribute("player",e.player),a.setAttribute("shotType",e.type),a.setAttribute("minute",e.minute),a.appendChild(function(e,t,n){var a=document.createElement("div");return a.classList.add("shotline"),a.style.top=e.startpoint.y-1+"px",a.style.left=e.startpoint.x-1+"px",a.style.width=R(e.startpoint,e.endpoint)+"px",a.style.transform="rotate("+K(e.startpoint,e.endpoint)+"deg)",a.style.borderTopColor=n,a}(e,0,n)),a.appendChild(function(e,t,n){var a=document.createElement("div");return a.classList.add("shotend"),a.style.borderColor=n,a.style.backgroundColor=n,a.style.top=e.endpoint.y-2+"px",a.style.left=e.endpoint.x-1+"px",a}(e,0,n)),a.appendChild(function(e,t,n){var a=document.createElement("div");a.classList.add("shotstart"),a.style.borderColor=n,a.style.backgroundColor=n,a.style.top=e.startpoint.y-5+"px",a.style.left=e.startpoint.x-5+"px";var o="G"==e.type?"Гол":"V"==e.type?"Удар в створ":"W"==e.type?"Автогол":"Block"==e.type?"Блок":"B"==e.type?"Каркас ворот":"Мимо";return a.addEventListener("mouseenter",(function(n){var a=document.querySelector("#one-shot-legend"),r=" Минута "+e.minute+", "+o+", "+e.xG+",\n\r "+e.player+"."+t.playerName;a.textContent=r,a.style.display="inline-block"})),a.addEventListener("mouseleave",(function(e){document.querySelector("#one-shot-legend").style.display="none"})),a}(e,t,n)),a}function Y(e,t,n,a){e.forEach((function(e,a){var o={playerName:t[e.player-1].name,team:n};document.querySelector("#chalkboard").appendChild(X(e,o))}))}function Q(e,t){if("U"==e){if(!t.miss)return void(t.miss=1);t.miss++}if("G"==e){if(!t.goals)return void(t.goals=1);t.goals++}if("B"==e){if(!t.bar)return void(t.bar=1);t.bar++}if("Block"==e){if(!t.block)return void(t.block=1);t.block++}if("V"==e){if(!t.stvor)return void(t.stvor=1);t.stvor++}if("W"==e){if(!t.autogoals)return void(t.autogoals=1);t.autogoals++}}function ee(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o="."+t+"Shot";document.querySelectorAll(o).forEach((function(o){if(a)o.style.display="none";else{var r=document.querySelector("#"+t+"-player-list_"+o.getAttribute("player")+" input"),i=!!r&&r.checked;o.style.display=e?"block":i&&!n?"block":"none"}}))}function te(e,t){document.querySelectorAll("[class$=Shot]").forEach((function(n){var a=+n.getAttribute("minute"),o=a>=+e&&a<=+t;n.style.display=o?"block":"none"}))}function ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"home",n=document.querySelectorAll(".shots-container-wrapper")[0],a=parseInt("home"==t?n.getAttribute("data-homes"):n.getAttribute("data-aways"));return-1==e?a--:a++,a<0&&(a=0),"home"==t?n.setAttribute("data-homes",a):n.setAttribute("data-aways",a),a}function ae(e){var t=document.createElement("input");return t.type="checkbox",t.checked=!1,t.style.cursor="pointer",t.addEventListener("click",(function(t){this.checked?(ne(1,e.team),ee(!1,e.team,!1)):0==ne(-1,e.team)?ee(!0,e.team):ee(!1,e.team,!1)})),t}function oe(e){e.preventDefault();var t=this.getAttribute("data-type"),n=".shot[shottype="+t+"]",a="bold"==this.style.fontWeight;document.querySelectorAll(n).forEach((function(e){e.style.display=a?"none":"block"})),"G"==t&&document.querySelectorAll(".shot[shottype=W]").forEach((function(e){e.style.display=a?"none":"block"})),this.style.fontWeight=a?"normal":"bold"}Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),a=n.length>>>0,o=arguments[1],r=0;r<a;r++)if(t=n[r],e.call(o,t,r,n))return t}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)});var re=document.getElementById("filterGoals");re.addEventListener("click",oe.bind(re));var ie=document.getElementById("filterStvor");ie.addEventListener("click",oe.bind(ie));var le=document.getElementById("filterMiss");le.addEventListener("click",oe.bind(le));var se=document.getElementById("filterBars");se.addEventListener("click",oe.bind(se));var ce=document.getElementById("filterBlocks");function ue(e){var t=document.getElementById(e);t.setAttribute("start",0),t.setAttribute("end",125),t.dispatchEvent(new Event("change",{bubbles:!0}))}function de(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];ee(e,"home",!0,!e),ee(e,"away",!0,!e),e&&(document.querySelectorAll(".squadAndShots-containers-wrapper input[type=checkbox]").forEach((function(e){e.checked=y})),ue("shots-time-filter")),document.querySelectorAll("a[id^=filter]:nth-of-type(-n+5)").forEach((function(t){t.style.fontWeight=e?"bold":"normal"}))}function pe(e){return"corner"==e.type?"угловой":"throw"==e.type?"аут":"freekick"==e.type?"штрафной":"goalkick"==e.type?"от ворот":""}function me(e,t){return" Минута "+e.minute+", "+(e.good?"точно":"неточно")+(e.high?", верхом ,":", низом ,")+pe(e)+",\n\r "+t.player+"."+t.playerName}function he(e,t){var n=e.good?"blue":"red",a=document.createElement("div");a.classList.add("pass");var o=t.team+"Pass";return a.classList.add(o),a.setAttribute("player",e.player),a.setAttribute("passType",e.type),a.setAttribute("minute",e.minute),a.setAttribute("high",e.high),a.setAttribute("good",e.good),a.appendChild(function(e,t,n){var a=document.createElement("div");return a.classList.add("pass-line"),a.style.top=e.startpoint.y-1+"px",a.style.left=e.startpoint.x-1+"px",a.style.width=R(e.startpoint,e.endpoint)+"px",a.style.transform="rotate("+K(e.startpoint,e.endpoint)+"deg)",a.style.borderTopColor=n,a.addEventListener("mouseenter",(function(n){var a=document.querySelector("#one-pass-legend");a.textContent=me(e,t),a.style.display="inline-block"})),a.addEventListener("mouseleave",(function(e){document.querySelector("#one-pass-legend").style.display="none"})),a}(e,t,n)),a.appendChild(function(e,t,n){var a=document.createElement("div");return a.classList.add("pass-start"),a.style.borderColor=n,a.style.backgroundColor=n,a.style.top=e.startpoint.y-5+"px",a.style.left=e.startpoint.x-5+"px",pe(e),a.addEventListener("mouseenter",(function(n){var a=document.querySelector("#one-pass-legend");a.textContent=me(e,t),a.style.display="inline-block"})),a.addEventListener("mouseleave",(function(e){document.querySelector("#one-pass-legend").style.display="none"})),a}(e,t,n)),a}function ye(e,t){document.querySelectorAll("[class$=Pass]").forEach((function(n){var a=+n.getAttribute("minute"),o=a>=+e&&a<=+t;n.style.display=o?"block":"none"}))}function fe(e,t,n,a){var o=document.querySelector("#passesboard");o.querySelectorAll(".pass").forEach((function(e,t,n){})),e.forEach((function(e,a){e[0]&&e.forEach((function(e){var r={playerName:t[a].name,team:n,player:a+1};o.appendChild(he(e,r))}))}))}ce.addEventListener("click",oe.bind(ce)),document.getElementsByClassName("shots-container")[0].addEventListener("click",(function(e){de()})),document.getElementById("filter-show-all").addEventListener("click",(function(e){e.preventDefault(),de()})),document.getElementById("filter-hide-all").addEventListener("click",(function(e){e.preventDefault(),de(y)}));var ve,ge,be,xe,we=60;function Ee(e){for(var t=[],n=0;n<=d;n++)t.push({x:0,y:0,points:0});return e.forEach((function(e,n){var a=e.filter((function(e){return null!=e})),o=a.length;if(!(0===n||o<1)){a.forEach((function(e,a){t[n].x+=e.x/o,t[n].y+=e.y/o,t[n].points++}));var r=t.map((function(e,t){return{playerRank:t,points:e.points}})).slice(1).sort((function(e,t){return+t.points-+e.points}));t[0].order=r}})),t}function Pe(e,t){var n=e.ball,a={n:0,length:1e4},o={n:0,length:1e4};return e.home.forEach((function(e){var t=H(e,n,!1);t<a.length?(o.n=a.n,o.length=a.length,a.n=e.n,a.length=t):t<o.length&&(o.n=e.n,o.length=t)})),e.away.forEach((function(e){var t=H(e,n,!0);t<a.length?(o.n=a.n,o.length=a.length,a.n=e.n+d,a.length=t):t<o.length&&(o.n=e.n+d,o.length=t)})),[a,o]}Date.now();function Ce(e,t,n){ve.setData({max:we*m,data:e}),ge.setData({max:we*m,data:t}),be.setData({max:we*p,data:n})}function ke(e,t){try{var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home";s[e]=A[e].PointsFull.map((function(e){return e.slice(r,i)})),s[e].forEach((function(t,n){0!==n&&t.filter((function(e){return null!=e})).forEach((function(t){return l[e].push(t)}))}))},a=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",t=Ee(s[e]).slice(),n=t[0].order,a=function(a){var o=document.getElementById(e+"AvgPoints"+a),r=n.indexOf(n.find((function(e){return e.playerRank==a})));o.style.display=r<11?"inherit":"none",o.style.left=t[a].x-5+"px",o.style.top=t[a].y-5+"px";var i=document.getElementById("both"+e+"AvgPoints"+a);i.style.display=o.style.display,i.style.left=o.style.left,i.style.top=o.style.top,document.getElementById(e+"-player-list_"+a+"_name").style.fontWeight=r<11?"bold":"normal"},o=1;o<=d;o++)a(o)},o=0==e?1:e;if(o>t||+t-+o<=f)return;var r=B[o],i=B[t],l={home:[],away:[],ball:[]},s={home:[],away:[]};l.ball=q.slice(r,i),n("home"),n("away"),Ce(l.home,l.away,l.ball),a("home"),a("away")}catch(e){console.log(e)}}function Se(){function e(e){return window.location.origin+window.location.pathname+"?"+e.replace("http://pefl.ru/tv/#/","")}var t=document.querySelector("#tv-url-input");function n(e){if(A[e].TacticPoints.length>1)for(var t=1;t<A[e].TacticPoints.length;t++)if(!(A[e].TacticPoints[t].period<f))for(var n=function(n){var a=document.querySelector("#"+e+"AvgPoints_"+t+"_"+n),o=A[e].TacticPoints[t].rankByMinutes;a.style.display=o.indexOf(o.find((function(e){return e[0]==n})))<11?"inherit":"none"},a=1;a<=d;a++)n(a)}document.getElementById("tv-url").href=window.location.href.replace("http://pefl.ru/heatmaps.html?","http://pefl.ru/tv/#/").replace(":8080//",":8080/").replace("http://localhost:8080/heatmaps.html?","http://pefl.ru/tv/#/"),document.getElementById("json-url").href=F(),document.querySelector("#updateButton").addEventListener("click",(function(n){n.preventDefault(),t.value.match(/http\:\/\/pefl.ru\/tv\/\#\/j\=\d+\&z\=.+/i)?window.location.assign(e(t.value)):alert("Вставьте корректную ссылку на ТВ матча в поле ввода!")})),document.querySelector("#newWindow").addEventListener("click",(function(n){n.preventDefault(),t.value.match(/http\:\/\/pefl.ru\/tv\/\#\/j\=\d+\&z\=.+/i)?window.open(e(t.value),"_blank"):alert("Вставьте корректную ссылку на ТВ матча в поле ввода!")})),setTimeout((function(){document.querySelector("#shots-chalkboard ~ .bojan__content").appendChild(Te("shots",O,te)),document.querySelector("#maps-filtered ~ .bojan__content").appendChild(Te("maps",O,ke)),document.querySelector("#pass-chalkboard ~ .bojan__content").appendChild(Te("pass",O,ye)),document.getElementById("norm-tactic-avg").addEventListener("click",(function(e){e.preventDefault(),n("home"),n("away")})),document.getElementById("reset-maps-filtering").addEventListener("click",(function(e){e.preventDefault(),ke(0,125),ue("maps-time-filter")}))}),200)}function Te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[[[0,125]],[[0,125]]],n=arguments.length>2?arguments[2]:void 0,a=document.createElement("div");function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,125],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"home",n=document.createElement("div");n.classList.add("time-slider__tacticks");var a=document.createElement("span");a.innerText="home"===t?"Тактики хозяев":"Тактики гостей",n.appendChild(a);var o=document.createElement("ul");return e.forEach((function(e){var t=document.createElement("li");t.innerText=e[0]+" - "+e[1],t.classList.add("time-slider__tacticks__ref"),t.addEventListener("click",(function(t){t.preventDefault(),c(e[0],e[1]),u()})),o.appendChild(t)})),n.appendChild(o),n}a.classList.add("time-slider"),a.id=e+"-time-filter",a.addEventListener("change",(function(e){e.preventDefault(),u()})),c(0,125);var r=document.createElement("div");r.classList.add("time-slider__inputs");var i=document.createElement("input");i.type="number",i.min=0,i.max=125,i.value=0,i.id=e+"-start-input";var l=i.cloneNode(!0);l.id=e+"-end-input",i.addEventListener("change",(function(e){var t;e.preventDefault(),+this.value>+a.getAttribute("end")-3&&(this.value=+a.getAttribute("end")-3),t=this.value,a.setAttribute("start",t),u()})),l.addEventListener("change",(function(e){var t;e.preventDefault(),+this.value<+a.getAttribute("start")+3&&(this.value=+a.getAttribute("start")+3),t=this.value,a.setAttribute("end",t),u()}));var s=document.createElement("span");function c(e,t){a.setAttribute("start",e),a.setAttribute("end",t)}function u(){var e=+a.getAttribute("start"),t=+a.getAttribute("end");i.value=e,l.value=t,n(e,t)}return s.innerText="Границы периода",r.appendChild(i),r.appendChild(s),r.appendChild(l),t[0].length>0&&a.appendChild(o(t[0])),t[1].length>0&&a.appendChild(o(t[1],"away")),a.appendChild(r),u(),a}window.onload=function(){var e=new XMLHttpRequest;e.overrideMimeType("application/json"),e.onreadystatechange=function(){if(this.readyState==this.OPENED&&e.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),4==this.readyState){if(200==this.status){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.65,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s;return h337.create({container:document.querySelector(e),maxOpacity:a,minOpacity:n,radius:u*t})},n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home";if(document.querySelector("#"+e+"-tacticks-heatmaps + .bojan__label .bojan__label__header").textContent="Смены тактик "+xe[e].team.name,A[e].TacticPoints.length>1)for(var t=function(t){if(A[e].TacticPoints[t].period<f)return"continue";A[e].TacticPoints[t].rankByMinutes=[],A[e].TacticPoints[t].averages.forEach((function(n,a){var o=n.length;A[e].TacticPoints[t].rankByMinutes[a]=[a,o],0===a||o<2||n.forEach((function(e,t,a){n[0].x+=e.x/o,n[0].y+=e.y/o}))})),A[e].TacticPoints[t].rankByMinutes.sort((function(e,t){return t[1]-e[1]}));var n=document.getElementsByClassName("heatmap2-containers-wrapper")[0].cloneNode(!0),a="#heatmap-tactic"+e+t,o="#heatmap-ball"+e+t,r=(A[e].TacticPoints[t].start>0?"от "+A[e].TacticPoints[t].start:"")+" "+(A[e].TacticPoints[t].end<125?"до "+A[e].TacticPoints[t].end:"")+".  "+xe[e].team.name;n.querySelector("#heatmap-home").id="heatmap-tactic"+e+t,n.querySelector(a+" > div").textContent="Игроки "+r,n.querySelector("#heatmap-away").id="heatmap-ball"+e+t,n.querySelector(o+" > div").textContent="Мяч "+r,document.querySelector("#"+e+"-tacticks-heatmaps ~ .bojan__content").appendChild(n);var i=document.getElementsByClassName("heatmap-container-wrapper")[1].cloneNode(!0);i.className="heatmap-container-wrapper",n.className="heatmap3-containers-wrapper",i.querySelector(".heatmap-container").id="avgPositions"+w(e)+t,i.querySelector(".heatmap-container > div").textContent="Ср.поз."+r,n.appendChild(i);for(var l=function(n){var a=document.querySelector("#player_default_"+e).cloneNode(!0);a.id=e+"AvgPoints_"+t+"_"+n;var o=A[e].TacticPoints[t].rankByMinutes;a.style.display=o.indexOf(o.find((function(e){return e[0]==n})))<11?"inherit":"none",a.style.left=A[e].TacticPoints[t].averages[n][0].x-5+"px",a.style.top=A[e].TacticPoints[t].averages[n][0].y-5+"px",a.querySelector(".player_number").textContent=xe[e].players[n-1].number,a.querySelector(".tooltiptext").textContent=xe[e].players[n-1].name+"    "+xe[e].players[n-1].number,document.querySelector("#avgPositions"+w(e)+t).appendChild(a)},m=1;m<=d;m++)l(m);h337.create({container:document.querySelector(a),maxOpacity:s,minOpacity:c,radius:u}).setData({max:we,data:A[e].TacticPoints[t].team}),h337.create({container:document.querySelector(o),maxOpacity:s,minOpacity:c,radius:.67*u*1.1}).setData({max:we*p*.35,data:A[e].TacticPoints[t].ball})},n=1;n<A[e].TacticPoints.length;n++)t(n);O.push(A[e].TacticPoints.filter((function(e,t){return t>0&&e.period>3})).map((function(e){return[e.start,e.end]})))},a=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=e||"home",r=t||1,i=n||A.home.TacticPoints,l=o+"AvgPoints"+r,s="both"+o+"AvgPoints"+r,c=document.getElementById(l).style,u=document.getElementById(s).style;if(c.display=a?"inherit":"none",u.display=a?"inherit":"none",i.length>1)for(var d=1;d<i.length;d++)if(!(i[d].period<f)){var p=o+"AvgPoints_"+d+"_"+r;document.getElementById(p).style.display=a?"inherit":"none"}},r=function(e){for(var t=1;t<=d;t++){var n=document.querySelector("#player_default_"+e).cloneNode(!0);n.id=e+"AvgPoints"+t,n.plId=("home"===e?"hm":"aw")+t;var o=e+"-player-list_"+t,r=document.createElement("div");r.className="playerRow",r.id=o;var i=document.createElement("div");i.innerText=xe[e].players[t-1].number+". ",i.className="player-list-num";var l=document.createElement("div");l.className="player-list-name";var s=document.createElement("a");s.id=o+"_name",s.innerText=xe[e].players[t-1].name,s.href="#",s.addEventListener("click",(function(t){t.preventDefault(),this.style.fontWeight="bold"==this.style.fontWeight?"normal":"bold",a(e,this.id.replace(e+"-player-list_","").replace("_name",""),A[e].TacticPoints,"bold"==this.style.fontWeight||y)})),xe[e].players[t-1].sub&&s.appendChild((B=xe[e].players[t-1].sub,_=void 0,L=void 0,_=(B||h)==h?"http://pefl.ru/system/img/gm/out.gif":"http://pefl.ru/system/img/gm/in.gif",(L=document.createElement("img")).src=_,L)),l.appendChild(s),r.appendChild(i),r.appendChild(l);var c=document.createElement("div");c.className="player-list-eye",c.innerText=" ",r.appendChild(c);var u=document.createElement("div");u.className="player-list-shots";var p=(x=xe[e].players[t-1],E=void 0,P=void 0,C=void 0,k=void 0,S=void 0,T=void 0,q=void 0,E=x.autogoals?""+-parseInt(x.autogoals):"",P=x.goals?parseInt(x.goals):0,C=P+(x.stvor?parseInt(x.stvor):0),k=C+(x.miss?parseInt(x.miss):0),S="|"+P+E,T=x.bar?"|"+parseInt(x.bar):" ",q=x.block?"|"+parseInt(x.block):" ",k+T+q==0&&""==E?" ":0==k?"        "+E+q+T:(k>9?k:" "+k)+"|"+C+S+" "+q+T);u.innerText=p;var m=document.createElement("div");if(m.className="playerShotCheckbox"," "==p)m.innerText=" ";else{m.appendChild(ae({player:t,team:e}));var f=document.createElement("div");f.className="tooltiptext",f.innerText="Удары|В створ|Голы-автоголы   |Блокированные|Каркас",u.appendChild(f)}r.appendChild(m),r.appendChild(u);var v=document.createElement("div");v.className="player-list-mileage",v.innerText=Number(A[e].Mileage[t]/1e3).toFixed(2)+"км",r.appendChild(v),document.querySelector("#squad"+w(e)).appendChild(r),n.querySelector(".player_number").textContent=xe[e].players[t-1].number,n.querySelector(".tooltiptext").textContent=xe[e].players[t-1].name+"    "+xe[e].players[t-1].number,document.getElementById("heatmap-avg"+w(e)).appendChild(n);var g=n.cloneNode(!0);g.id="both"+g.id,document.getElementById("heatmap-avgBoth").appendChild(g);var b=n.cloneNode(!0);b.style.display=A[e].AvgPoints[t].x>8&&A[e].AvgPoints[t].y>8?"inherit":"none",b.id=b.id+"_individual",b.style.left=A[e].AvgPoints[t].x-5+"px",b.style.top=A[e].AvgPoints[t].y-5+"px",document.querySelector("#heatmap-"+e+t).appendChild(b)}var x,E,P,C,k,S,T,q,B,_,L},l=this.responseText.match(k),m=l?l.pop():["0:0"];xe=JSON.parse(this.responseText),R=document.querySelector("#player_default_away .player_shape").style,H=document.querySelector("#player_default_home .player_shape").style,R.backgroundColor="#"+xe.away.team.back,R.borderColor="#"+xe.away.team.color,R.color="#"+xe.away.team.color,H.color="#"+xe.home.team.color,H.borderColor="#"+xe.home.team.color,H.backgroundColor="#"+xe.home.team.back;var b=xe.game;console.log("rep  - ",xe);var x={corner:!1,throwIn:!1,deadBall:!1,goalKick:!1,center:!0,team:0,ballOwner:0},w=function(e){return"home"===e?"Home":"Away"};b.slice(1,-1);var T="0:0",j=null;try{b.forEach((function(e,t,n){var a,r=t>0?n[t-1]:null;e.C&&(x.corner=!0,x.team=e.C),e.A&&(x.throwIn=!0,x.team=e.A),e.F&&(x.deadBall=!0,x.team=e.F),e.T&&(x.goalKick=!0,x.team=e.T.team),e.N&&(x.center=!0,x.team=e.N);var i,l,s,c,u=[],p=[];if(e.coordinates){var m=function(){return!!j&&!!j.start},y=function(){j.start=null},f=function(){var t={high:1===k.z,minute:e.minute,episode:e.num,good:j.good,endpoint:null,startpoint:null,type:null,outfield:j.outfield,player:j.start.player},n={x:j.end.ball.w,y:j.end.ball.h};t.endpoint=z(n,M,v,g);var a={x:j.start.ball.w,y:j.start.ball.h};t.startpoint=z(a,M,v,g),t.outfield&&console.log(" save pass - ",j,t),I[t.player].push(o({},t))},b=function(e){j={start:{ball:o({},k),player:e.n}}},w=function(e){j.end={ball:o({},k),player:e.n}},k=e.coordinates.ball;try{p=r&&r.coordinates&&Pe(r.coordinates),u=Pe(e.coordinates),console.log(" playersCloseToBall - ",u,p,e),i=u[0],c=u[1],l=p&&p[0],s=p&&p[1],e.N&&(j&&(console.log("closestPlayer- ",i),b(i)),j||b(i),j.N=!0,console.log("STARTED N ",j)),0===t&&console.log("Start element - ",e);(function(){if(U)y();else{if(!m())return i&&0===i.length?(b(i),void console.log("PLAYER OWNS BALL")):void 0;if(e.G||e.W||e.B||e.U||e.V)y();else if(!(!l||!i)&&0===i.length&&0===l.length&&l.n===i.n&&c.length>0&&s.length>0)b(i);else{if(k.w<=g.x1||k.w>=g.x2||k.h<=g.y1||k.h>=g.y2)return j.good=0,j.outfield=!0,console.log("Ball outfield",k,e),w(i),f(),void y();(function(){if(j)return j.N&&i&&m()&&0===i.length&&console.log(" passObject  closestPlayer isPassOpened()",j,i,m()),j.N&&i&&m()&&0===i.length})()&&(j.good=1,w(i),f(),b(i)),l&&s&&i&&c&&0===l.length&&s.length>0&&0===i.length&&c.length>0&&(l&&i&&J(l.n,i.n)?(j.good=1,w(i),f(),b(i)):(j.good=0,w(i),f(),b(i)))}}})()}catch(t){console.log("closest players error",t,e)}}function O(t,n){return e.messages[t].mes.match(n)}if(e.interval&&parseInt(e.interval),B[e.minute]||(B[e.minute]=A.home.Points[1].length),e.S&&(1==e.S.team?(xe.home.players[e.S.in-1].sub=2,xe.home.players[e.S.out-1].sub=h):(xe.away.players[e.S.in-1].sub=2,xe.away.players[e.S.out-1].sub=h)),e.messages[0]){var D,G,W={},V=!1;try{if(e.coordinates){try{x.center&&e.messages&&e.messages.some((function(e){return e.mes.match(E)}))&&(x.center=!1,l.n)}catch(t){console.log(" N error",t,e)}var F=e.coordinates.ball,R=r.coordinates?r.coordinates.ball:void 0,H={x:F.w,y:F.h};if(x.corner&&e.messages[1]){W.endpoint=z(H,M,v,g),W.high=1===F.z,W.minute=e.minute,W.episode=e.num,W.type="corner",x.corner=!1;var K={x:R.w,y:R.h};D=Z(e.messages[0]),W.startpoint=z(K,M,v,g),e.messages[2]?(G=Z(e.messages[2]),W.good=J(G,D)):(W.good=!0,G=Z(e.messages[1])),G,W.player=D,N[D].push(W)}else if(x.throwIn&&e.messages[0]){W.endpoint=z(H,M,v,g),W.high=1===F.z,W.minute=e.minute,W.episode=e.num,W.type="throw",x.throwIn=!1,(D=Z(r.messages[r.messages.length-1]))||(r=n[t-2]),(D=Z(r.messages[r.messages.length-1]))||(r=n[t-3]);var X={x:(R=r.coordinates.ball).w,y:R.h};D=Z(r.messages[r.messages.length-1]),W.startpoint=z(X,M,v,g),G=Z(e.messages[e.messages.length-1]),W.good=J(G,D),G,W.player=D,N[D].push(W)}else if(x.deadBall)x.deadBall=!1;else if(x.goalKick){W.endpoint=z(H,M,v,g),W.high=1===F.z,W.minute=e.minute,W.episode=e.num,V=!0,W.type="goalkick";var Y={x:R.w,y:R.h};if(x.goalKick=!1,D=l.n,W.startpoint=z(Y,M,v,g),e.messages[0]&&(O(0,P)&&(e.messages[1]?(G=+O(1,S)[0],W.good=J(D,G)):V=!0),"goalkick"===W.type&&V)){var Q=+O(0,S)[0];W.good=O(0,P)||Q,V=!1}W.player=D,N[D].push(W)}}}catch(t){console.log("error ",r),console.log("Что то не так с обсчетом паса",e.minute,e.n,t)}if(e.messages.forEach((function(e){e.mes.indexOf(" СЧЕТ ")>-1&&(T=e.mes.replace(" СЧЕТ ",""))})),"Серия пенальти!..."==e.messages[0].mes||"Матч переходит к послематчевым одиннадцатиметровым!..."==e.messages[0].mes||"Назначаются послематчевые пенальти!..."==e.messages[0].mes)throw U=!0,"Серия пенальти!..."}if(e.ZT){var ee=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home";A[t].TacticPoints[0].end=e.minute,A[t].TacticPoints[0].period=e.minute-A[t].TacticPoints[0].start,A[t].TacticPoints.push(A[t].TacticPoints[0]),A[t].TacticPoints[0]={start:e.minute,end:125,period:125-e.minute,team:[],ball:[],averages:[]},A[t].TacticChanges.push(A[t].Points[0].length);for(var n=0;n<=d;n++)A[t].TacticPoints[0].averages.push([{x:0,y:0}])};1==e.ZT.team?(ee("home"),A.home.TacticChanges.push(A.home.Points[0].length)):ee("away")}try{if((e.U||e.W)&&!U){var te=e.coordinates.ball,ne={x:te.w,y:te.h,value:1},ae=e.G?"G":e.V?"V":e.W?"W":e.B?"B":e.U.team>2?"Block":"U",oe=n[t-1].coordinates?n[t-1].coordinates.ball:n[t-2].coordinates?n[t-2].coordinates.ball:n[t-3].coordinates?n[t-3].coordinates.ball:n[t-4].coordinates.ball,re={x:oe.w,y:oe.h,value:1},ie={endpoint:z(ne,M,v,g),startpoint:z(re,M,v,g),episode:t,type:ae,minute:e.minute,player:e.U?e.U.player:e.W.player,xG:e.U?e.U.xG?e.U.xG:"ждем xG":e.W.xG?e.W.xG:"ждем xG"};e.U&&(1==e.U.team||3==e.U.team)||e.W&&(2==e.W.team||4==e.W.team)?L.home.push(ie):L.away.push(ie)}if((e.G||e.V||e.B)&&!e.U){var le=e.coordinates.ball;console.log("goal event in next episode -  min=",e.minute," U=",e.U," W=",e.W," V=",e.V," G=",e.G," B=",e.B,le);var se,ce=z({x:le.w,y:le.h,value:1},M,v,g);se=e.G&&(1==e.G.team||3==e.G.team)||e.V&&(1==e.V.team||3==e.V.team)||e.B&&(1==e.B.team||3==e.B.team)?L.home[L.home.length-1]:L.away[L.away.length-1],n[t-1].messages.length>0&&n[t-1].messages.some((function(e){return e.mes.match(C)}))&&(se.startpoint=se.endpoint),se.type=e.G?"G":e.V?"V":"B",se.endpoint=ce,se.player=e.G?e.G.player:e.V?e.V.player:e.B.player}}catch(a){console.log("Что то не так с обсчетом удара",e.minute,e.n,a),console.log(e,n[t-1],n[t-2])}function ue(e,t){for(var n=1;n<=d;n++)e[n].push(t[n])}if(e.M&&(M=!M),e.coordinates){var de=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",n=e.coordinates[t],o=[],r=0;r<=d;r++)o.push(null);n.forEach((function(e){if(a=1==e.n?{x:e.w,y:e.h,value:.2}:{x:e.w,y:e.h,value:1},e.n<=d){var n=z(a,"home"===t?M:!M);if(A[t].Points[e.n].push(n),A[t].Points[0].push(n),A[t].TacticPoints[0].team.push(n),A[t].TacticPoints[0].averages[e.n].push(n),A[t].Points[e.n].length>1){var r=A[t].Points[e.n].length-1;A[t].Mileage[e.n]+=$(A[t].Points[e.n][r],A[t].Points[e.n][r-1])}o[e.n]=n}else _[t].push(e)})),A[t].TacticPoints[0].ball.push(me),ue(A[t].PointsFull,o)},pe=e.coordinates.ball,me=z({x:pe.w,y:pe.h,value:1},M);q.push(me),de("home"),de("away")}}))}catch(e){console.log("game.forEach ",e)}A.home.TacticPoints.push(A.home.TacticPoints[0]),A.away.TacticPoints.push(A.away.TacticPoints[0]);var D=T+(m==T?"":"(".concat(function(e,t){var n=e.split(":"),a=t.split(":");return"".concat(a[0]-n[0],":").concat(a[1]-n[1])}(T,m),")")),G=xe.date+". "+(xe.stadium.city?xe.stadium.city+". ":"")+xe.stadium.name+". "+xe.home.team.name+" - "+xe.away.team.name+" "+D;document.querySelector("#game-info").textContent=G,console.log("oldpasses -",N),console.log("passes -",I);var W=N.reduce((function(e,t,n){var a=t.filter((function(e){return"goalkick"===e.type}));return a[0]?[].concat(i(e),i(a)):i(e)}),[]);console.log("gkPasses   ",W),L.home.forEach((function(e){Q(e.type,xe.home.players[e.player-1])})),L.away.forEach((function(e){Q(e.type,xe.away.players[e.player-1])})),ve=t("#heatmap-home"),ge=t("#heatmap-away"),be=t("#heatmap-ball",.67),Ce(A.home.PointsFull,A.away.PointsFull,q),t("#heatmap-avgHome"),t("#heatmap-avgAway"),t("#chalkboard"),t("#heatmap-avgBoth"),t("#passesboard");n("home"),n("away"),setTimeout((function(){for(var e=function(e){var t=document.getElementsByClassName("heatmap2-containers-wrapper")[0].cloneNode(!0);function n(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",a="#heatmap-"+n+e;t.querySelector("#heatmap-"+n).id="heatmap-"+n+e,t.querySelector(a+" > div").textContent=xe[n].players[e-1].number+". "+xe[n].players[e-1].name,"home"===n&&document.querySelector("#separate-heatmaps ~ .bojan__content").appendChild(t),h337.create({container:document.querySelector(a),maxOpacity:s,minOpacity:c,radius:u}).setData({max:we,data:A[n].Points[e]})}n("home"),n("away")},t=1;t<=d;t++)e(t)}),10),document.querySelector("#heatmap-home .overlay").textContent=xe.home.team.name,document.querySelector("#heatmap-away .overlay").textContent=xe.away.team.name,document.querySelector("#heatmap-avgHome .overlay").textContent="Средние позиции "+xe.home.team.name,document.querySelector("#heatmap-avgAway .overlay").textContent="Средние позиции "+xe.away.team.name,A.home.TacticChanges.push(A.home.Points[0].length-1),A.away.TacticChanges.push(A.away.Points[0].length-1),A.home.AvgPoints=Ee(A.home.Points).slice(),A.away.AvgPoints=Ee(A.away.Points).slice(),setTimeout((function(){r("home"),r("away")}),50),setTimeout((function(){document.body.removeChild(document.querySelector(".loader-wrapper"))}),200);var V=document.querySelector("#chalkboard .heatmap-canvas"),F=document.querySelector("#passesboard .heatmap-canvas");if(V.getContext){V.getContext("2d");Y(L.away,xe.away.players,"away"),Y(L.home,xe.home.players,"home")}if(F.getContext){F.getContext("2d");fe(I.slice(19),xe.away.players,"away"),fe(I.slice(1,18),xe.home.players,"home")}}else alert("Вставьте верно ссылку на матч!");setTimeout(Se,200)}var R,H},e.open("GET",F("http://pefl.ru/tv/#/j=1099079&z=c3121c566116e3f04f0fba27f99d502c"),!0),e.send()}},{}]},{},[1]);
/*
 * heatmap.js v2.0.5 | JavaScript Heatmap Library
 *
 * Copyright 2008-2016 Patrick Wied <heatmapjs@patrick-wied.at> - All rights reserved.
 * Dual licensed under MIT and Beerware license 
 *
 * :: 2016-09-05 01:16
 */
(function (a, b, c) { if (typeof module !== "undefined" && module.exports) { module.exports = c() } else if (typeof define === "function" && define.amd) { define(c) } else { b[a] = c() } })("h337", this, function () { var a = { defaultRadius: 40, defaultRenderer: "canvas2d", defaultGradient: { .25: "rgb(0,0,255)", .55: "rgb(0,255,0)", .85: "yellow", 1: "rgb(255,0,0)" }, defaultMaxOpacity: 1, defaultMinOpacity: 0, defaultBlur: .85, defaultXField: "x", defaultYField: "y", defaultValueField: "value", plugins: {} }; var b = function h() { var b = function d(a) { this._coordinator = {}; this._data = []; this._radi = []; this._min = 10; this._max = 1; this._xField = a["xField"] || a.defaultXField; this._yField = a["yField"] || a.defaultYField; this._valueField = a["valueField"] || a.defaultValueField; if (a["radius"]) { this._cfgRadius = a["radius"] } }; var c = a.defaultRadius; b.prototype = { _organiseData: function (a, b) { var d = a[this._xField]; var e = a[this._yField]; var f = this._radi; var g = this._data; var h = this._max; var i = this._min; var j = a[this._valueField] || 1; var k = a.radius || this._cfgRadius || c; if (!g[d]) { g[d] = []; f[d] = [] } if (!g[d][e]) { g[d][e] = j; f[d][e] = k } else { g[d][e] += j } var l = g[d][e]; if (l > h) { if (!b) { this._max = l } else { this.setDataMax(l) } return false } else if (l < i) { if (!b) { this._min = l } else { this.setDataMin(l) } return false } else { return { x: d, y: e, value: j, radius: k, min: i, max: h } } }, _unOrganizeData: function () { var a = []; var b = this._data; var c = this._radi; for (var d in b) { for (var e in b[d]) { a.push({ x: d, y: e, radius: c[d][e], value: b[d][e] }) } } return { min: this._min, max: this._max, data: a } }, _onExtremaChange: function () { this._coordinator.emit("extremachange", { min: this._min, max: this._max }) }, addData: function () { if (arguments[0].length > 0) { var a = arguments[0]; var b = a.length; while (b--) { this.addData.call(this, a[b]) } } else { var c = this._organiseData(arguments[0], true); if (c) { if (this._data.length === 0) { this._min = this._max = c.value } this._coordinator.emit("renderpartial", { min: this._min, max: this._max, data: [c] }) } } return this }, setData: function (a) { var b = a.data; var c = b.length; this._data = []; this._radi = []; for (var d = 0; d < c; d++) { this._organiseData(b[d], false) } this._max = a.max; this._min = a.min || 0; this._onExtremaChange(); this._coordinator.emit("renderall", this._getInternalData()); return this }, removeData: function () { }, setDataMax: function (a) { this._max = a; this._onExtremaChange(); this._coordinator.emit("renderall", this._getInternalData()); return this }, setDataMin: function (a) { this._min = a; this._onExtremaChange(); this._coordinator.emit("renderall", this._getInternalData()); return this }, setCoordinator: function (a) { this._coordinator = a }, _getInternalData: function () { return { max: this._max, min: this._min, data: this._data, radi: this._radi } }, getData: function () { return this._unOrganizeData() } }; return b }(); var c = function i() { var a = function (a) { var b = a.gradient || a.defaultGradient; var c = document.createElement("canvas"); var d = c.getContext("2d"); c.width = 256; c.height = 1; var e = d.createLinearGradient(0, 0, 256, 1); for (var f in b) { e.addColorStop(f, b[f]) } d.fillStyle = e; d.fillRect(0, 0, 256, 1); return d.getImageData(0, 0, 256, 1).data }; var b = function (a, b) { var c = document.createElement("canvas"); var d = c.getContext("2d"); var e = a; var f = a; c.width = c.height = a * 2; if (b == 1) { d.beginPath(); d.arc(e, f, a, 0, 2 * Math.PI, false); d.fillStyle = "rgba(0,0,0,1)"; d.fill() } else { var g = d.createRadialGradient(e, f, a * b, e, f, a); g.addColorStop(0, "rgba(0,0,0,1)"); g.addColorStop(1, "rgba(0,0,0,0)"); d.fillStyle = g; d.fillRect(0, 0, 2 * a, 2 * a) } return c }; var c = function (a) { var b = []; var c = a.min; var d = a.max; var e = a.radi; var a = a.data; var f = Object.keys(a); var g = f.length; while (g--) { var h = f[g]; var i = Object.keys(a[h]); var j = i.length; while (j--) { var k = i[j]; var l = a[h][k]; var m = e[h][k]; b.push({ x: h, y: k, value: l, radius: m }) } } return { min: c, max: d, data: b } }; function d(b) { var c = b.container; var d = this.shadowCanvas = document.createElement("canvas"); var e = this.canvas = b.canvas || document.createElement("canvas"); var f = this._renderBoundaries = [1e4, 1e4, 0, 0]; var g = getComputedStyle(b.container) || {}; e.className = "heatmap-canvas"; this._width = e.width = d.width = b.width || +g.width.replace(/px/, ""); this._height = e.height = d.height = b.height || +g.height.replace(/px/, ""); this.shadowCtx = d.getContext("2d"); this.ctx = e.getContext("2d"); e.style.cssText = d.style.cssText = "position:absolute;left:0;top:0;"; c.style.position = "relative"; c.appendChild(e); this._palette = a(b); this._templates = {}; this._setStyles(b) } d.prototype = { renderPartial: function (a) { if (a.data.length > 0) { this._drawAlpha(a); this._colorize() } }, renderAll: function (a) { this._clear(); if (a.data.length > 0) { this._drawAlpha(c(a)); this._colorize() } }, _updateGradient: function (b) { this._palette = a(b) }, updateConfig: function (a) { if (a["gradient"]) { this._updateGradient(a) } this._setStyles(a) }, setDimensions: function (a, b) { this._width = a; this._height = b; this.canvas.width = this.shadowCanvas.width = a; this.canvas.height = this.shadowCanvas.height = b }, _clear: function () { this.shadowCtx.clearRect(0, 0, this._width, this._height); this.ctx.clearRect(0, 0, this._width, this._height) }, _setStyles: function (a) { this._blur = a.blur == 0 ? 0 : a.blur || a.defaultBlur; if (a.backgroundColor) { this.canvas.style.backgroundColor = a.backgroundColor } this._width = this.canvas.width = this.shadowCanvas.width = a.width || this._width; this._height = this.canvas.height = this.shadowCanvas.height = a.height || this._height; this._opacity = (a.opacity || 0) * 255; this._maxOpacity = (a.maxOpacity || a.defaultMaxOpacity) * 255; this._minOpacity = (a.minOpacity || a.defaultMinOpacity) * 255; this._useGradientOpacity = !!a.useGradientOpacity }, _drawAlpha: function (a) { var c = this._min = a.min; var d = this._max = a.max; var a = a.data || []; var e = a.length; var f = 1 - this._blur; while (e--) { var g = a[e]; var h = g.x; var i = g.y; var j = g.radius; var k = Math.min(g.value, d); var l = h - j; var m = i - j; var n = this.shadowCtx; var o; if (!this._templates[j]) { this._templates[j] = o = b(j, f) } else { o = this._templates[j] } var p = (k - c) / (d - c); n.globalAlpha = p < .01 ? .01 : p; n.drawImage(o, l, m); if (l < this._renderBoundaries[0]) { this._renderBoundaries[0] = l } if (m < this._renderBoundaries[1]) { this._renderBoundaries[1] = m } if (l + 2 * j > this._renderBoundaries[2]) { this._renderBoundaries[2] = l + 2 * j } if (m + 2 * j > this._renderBoundaries[3]) { this._renderBoundaries[3] = m + 2 * j } } }, _colorize: function () { var a = this._renderBoundaries[0]; var b = this._renderBoundaries[1]; var c = this._renderBoundaries[2] - a; var d = this._renderBoundaries[3] - b; var e = this._width; var f = this._height; var g = this._opacity; var h = this._maxOpacity; var i = this._minOpacity; var j = this._useGradientOpacity; if (a < 0) { a = 0 } if (b < 0) { b = 0 } if (a + c > e) { c = e - a } if (b + d > f) { d = f - b } var k = this.shadowCtx.getImageData(a, b, c, d); var l = k.data; var m = l.length; var n = this._palette; for (var o = 3; o < m; o += 4) { var p = l[o]; var q = p * 4; if (!q) { continue } var r; if (g > 0) { r = g } else { if (p < h) { if (p < i) { r = i } else { r = p } } else { r = h } } l[o - 3] = n[q]; l[o - 2] = n[q + 1]; l[o - 1] = n[q + 2]; l[o] = j ? n[q + 3] : r } k.data = l; this.ctx.putImageData(k, a, b); this._renderBoundaries = [1e3, 1e3, 0, 0] }, getValueAt: function (a) { var b; var c = this.shadowCtx; var d = c.getImageData(a.x, a.y, 1, 1); var e = d.data[3]; var f = this._max; var g = this._min; b = Math.abs(f - g) * (e / 255) >> 0; return b }, getDataURL: function () { return this.canvas.toDataURL() } }; return d }(); var d = function j() { var b = false; if (a["defaultRenderer"] === "canvas2d") { b = c } return b }(); var e = { merge: function () { var a = {}; var b = arguments.length; for (var c = 0; c < b; c++) { var d = arguments[c]; for (var e in d) { a[e] = d[e] } } return a } }; var f = function k() { var c = function h() { function a() { this.cStore = {} } a.prototype = { on: function (a, b, c) { var d = this.cStore; if (!d[a]) { d[a] = [] } d[a].push(function (a) { return b.call(c, a) }) }, emit: function (a, b) { var c = this.cStore; if (c[a]) { var d = c[a].length; for (var e = 0; e < d; e++) { var f = c[a][e]; f(b) } } } }; return a }(); var f = function (a) { var b = a._renderer; var c = a._coordinator; var d = a._store; c.on("renderpartial", b.renderPartial, b); c.on("renderall", b.renderAll, b); c.on("extremachange", function (b) { a._config.onExtremaChange && a._config.onExtremaChange({ min: b.min, max: b.max, gradient: a._config["gradient"] || a._config["defaultGradient"] }) }); d.setCoordinator(c) }; function g() { var g = this._config = e.merge(a, arguments[0] || {}); this._coordinator = new c; if (g["plugin"]) { var h = g["plugin"]; if (!a.plugins[h]) { throw new Error("Plugin '" + h + "' not found. Maybe it was not registered.") } else { var i = a.plugins[h]; this._renderer = new i.renderer(g); this._store = new i.store(g) } } else { this._renderer = new d(g); this._store = new b(g) } f(this) } g.prototype = { addData: function () { this._store.addData.apply(this._store, arguments); return this }, removeData: function () { this._store.removeData && this._store.removeData.apply(this._store, arguments); return this }, setData: function () { this._store.setData.apply(this._store, arguments); return this }, setDataMax: function () { this._store.setDataMax.apply(this._store, arguments); return this }, setDataMin: function () { this._store.setDataMin.apply(this._store, arguments); return this }, configure: function (a) { this._config = e.merge(this._config, a); this._renderer.updateConfig(this._config); this._coordinator.emit("renderall", this._store._getInternalData()); return this }, repaint: function () { this._coordinator.emit("renderall", this._store._getInternalData()); return this }, getData: function () { return this._store.getData() }, getDataURL: function () { return this._renderer.getDataURL() }, getValueAt: function (a) { if (this._store.getValueAt) { return this._store.getValueAt(a) } else if (this._renderer.getValueAt) { return this._renderer.getValueAt(a) } else { return null } } }; return g }(); var g = { create: function (a) { return new f(a) }, register: function (b, c) { a.plugins[b] = c } }; return g });
//# sourceMappingURL=hm.js.map
