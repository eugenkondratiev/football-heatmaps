!function e(t,n,a){function o(i,l){if(!n[i]){if(!t[i]){var s="function"==typeof require&&require;if(!l&&s)return s(i,!0);if(r)return r(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[i]={exports:{}};t[i][0].call(u.exports,(function(e){return o(t[i][1][e]||e)}),u,u.exports,e,t,n,a)}return n[i].exports}for(var r="function"==typeof require&&require,i=0;i<a.length;i++)o(a[i]);return o}({1:[function(e,t,n){"use strict";function a(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=.7,c=.05,u=35,d=18,p=.33,m=1.1,h=1,y=!1,f=3,v={x1:39,y1:38,x2:712,y2:458},g={x1:0,y1:0,x2:720,y2:450},b={x1:18.98,y1:19,x2:346.56,y2:229.5},x=/разыг|розыг/gi,w=/пас|переда|смотри/gi,E=/авес|аброс|линны/g,P=/\d+:\d+/g,C=/[0-9]+/gi,k=105/(b.x2-b.x1),S={home:{TacticChanges:[0],TacticPoints:[],Points:[],AvgPoints:[],Mileage:[],PointsFull:[]},away:{TacticChanges:[0],TacticPoints:[],Points:[],AvgPoints:[],Mileage:[],PointsFull:[]}},T=[],A=[0],q={home:[],away:[]},B={home:[],away:[]};S.home.TacticPoints.push({start:0,end:1,period:0,startPoint:0,endPoint:1,team:[],ball:[],averages:[]}),S.away.TacticPoints.push({start:0,end:1,period:0,startPoint:0,endPoint:1,team:[],ball:[],averages:[]});for(var _=[],L=[[]],O=[[]],I=0;I<=d;I++){var N=function(e){var t=e||"home";S[t].Points.push([]),S[t].Mileage.push(0),S[t].AvgPoints.push({x:0,y:0}),S[t].TacticPoints[0].averages.push([{x:0,y:0}]),S[t].PointsFull.push([])};N("home"),N("away")}for(var j=1;j<=2*d;j++)L.push([]),O.push([]);var G=!1,D=!1,M="http://pefl.ru/jsonreport.php";function W(e){var t=window.location.href.match(/j\=\d+\&z\=.+/i)?window.location.href:e,n=t.indexOf("&z="),a=t.indexOf("j=");return M+"?j=".concat(t.substring(2+a,n),"&z=").concat(t.substring(3+n))}function U(e){var t,n,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g,i=e.x,l=e.y;return a?(t=Math.round(o.x2-(i-r.x1)*(o.x2-o.x1)/(r.x2-r.x1)),n=Math.round(o.y2-(l-r.y1)*(o.y2-o.y1)/(r.y2-r.y1))):(t=Math.round(o.x1+(i-r.x1)*(o.x2-o.x1)/(r.x2-r.x1)),n=Math.round(o.y1+(l-r.y1)*(o.y2-o.y1)/(r.y2-r.y1))),{x:t,y:n,value:e.value}}function V(e,t){var n=t.x-e.x,a=t.y-e.y;return Math.sqrt(n*n+a*a)}function F(e,t){var n,a,o,r,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;return t?{n:e.n,h:n.y2-e.h,w:n.x2-e.w,value:1}:{n:e.n,h:e.h,w:e.w,value:1}}(e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]);return n=i,o=(a=t).w-n.w,r=a.h-n.h,Math.sqrt(o*o+r*r)}function z(e,t){var n=t.x-e.x,a=t.y-e.y;return(n<0?a<0?-180:180:0)+180*Math.atan(a/n)/Math.PI}function H(e,t){return k*V(e,t)}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e||!e.mes)return 0;for(var n=String(e.mes),a=n.length,o=0,r=[],i=0;i<a;i++)"["===n[i]?o=i+1:"]"===n[i]&&o<i&&o>0&&r.push(+n.substr(o,i-o));return o?r[t-1]?+r[t-1]:0:null}function K(e,t){return e<d+1&&t<d+1||e>d&&t>d}function Z(e,t){var n="G"==e.type?"red":"V"==e.type?"yellow":"Block"==e.type?"black":"B"==e.type?"black":"W"==e.type?"#FFA500":"blue",a=document.createElement("div");a.classList.add("shot");var o=t.team+"Shot";return a.classList.add(o),a.setAttribute("player",e.player),a.setAttribute("shotType",e.type),a.setAttribute("minute",e.minute),a.appendChild(function(e,t,n){var a=document.createElement("div");return a.classList.add("shotline"),a.style.top=e.startpoint.y-1+"px",a.style.left=e.startpoint.x-1+"px",a.style.width=V(e.startpoint,e.endpoint)+"px",a.style.transform="rotate("+z(e.startpoint,e.endpoint)+"deg)",a.style.borderTopColor=n,a}(e,0,n)),a.appendChild(function(e,t,n){var a=document.createElement("div");return a.classList.add("shotend"),a.style.borderColor=n,a.style.backgroundColor=n,a.style.top=e.endpoint.y-2+"px",a.style.left=e.endpoint.x-1+"px",a}(e,0,n)),a.appendChild(function(e,t,n){var a=document.createElement("div");a.classList.add("shotstart"),a.style.borderColor=n,a.style.backgroundColor=n,a.style.top=e.startpoint.y-5+"px",a.style.left=e.startpoint.x-5+"px";var o="G"==e.type?"Гол":"V"==e.type?"Удар в створ":"W"==e.type?"Автогол":"Block"==e.type?"Блок":"B"==e.type?"Каркас ворот":"Мимо";return a.addEventListener("mouseenter",(function(n){var a=document.querySelector("#one-shot-legend"),r=" Минута "+e.minute+", "+o+", "+e.xG+",\n\r "+e.player+"."+t.playerName;a.textContent=r,a.style.display="inline-block"})),a.addEventListener("mouseleave",(function(e){document.querySelector("#one-shot-legend").style.display="none"})),a}(e,t,n)),a}function $(e,t,n,a){e.forEach((function(e,a){var o={playerName:t[e.player-1].name,team:n};document.querySelector("#chalkboard").appendChild(Z(e,o))}))}function J(e,t){if("U"==e){if(!t.miss)return void(t.miss=1);t.miss++}if("G"==e){if(!t.goals)return void(t.goals=1);t.goals++}if("B"==e){if(!t.bar)return void(t.bar=1);t.bar++}if("Block"==e){if(!t.block)return void(t.block=1);t.block++}if("V"==e){if(!t.stvor)return void(t.stvor=1);t.stvor++}if("W"==e){if(!t.autogoals)return void(t.autogoals=1);t.autogoals++}}function X(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o="."+t+"Shot";document.querySelectorAll(o).forEach((function(o){if(a)o.style.display="none";else{var r=document.querySelector("#"+t+"-player-list_"+o.getAttribute("player")+" input"),i=!!r&&r.checked;o.style.display=e?"block":i&&!n?"block":"none"}}))}function Q(e,t){document.querySelectorAll("[class$=Shot]").forEach((function(n){var a=+n.getAttribute("minute"),o=a>=+e&&a<=+t;n.style.display=o?"block":"none"}))}function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"home",n=document.querySelectorAll(".shots-container-wrapper")[0],a=parseInt("home"==t?n.getAttribute("data-homes"):n.getAttribute("data-aways"));return-1==e?a--:a++,a<0&&(a=0),"home"==t?n.setAttribute("data-homes",a):n.setAttribute("data-aways",a),a}function ee(e){var t=document.createElement("input");return t.type="checkbox",t.checked=!1,t.style.cursor="pointer",t.addEventListener("click",(function(t){this.checked?(Y(1,e.team),X(!1,e.team,!1)):0==Y(-1,e.team)?X(!0,e.team):X(!1,e.team,!1)})),t}function te(e){e.preventDefault();var t=this.getAttribute("data-type"),n=".shot[shottype="+t+"]",a="bold"==this.style.fontWeight;document.querySelectorAll(n).forEach((function(e){e.style.display=a?"none":"block"})),"G"==t&&document.querySelectorAll(".shot[shottype=W]").forEach((function(e){e.style.display=a?"none":"block"})),this.style.fontWeight=a?"normal":"bold"}Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),a=n.length>>>0,o=arguments[1],r=0;r<a;r++)if(t=n[r],e.call(o,t,r,n))return t}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)});var ne=document.getElementById("filterGoals");ne.addEventListener("click",te.bind(ne));var ae=document.getElementById("filterStvor");ae.addEventListener("click",te.bind(ae));var oe=document.getElementById("filterMiss");oe.addEventListener("click",te.bind(oe));var re=document.getElementById("filterBars");re.addEventListener("click",te.bind(re));var ie=document.getElementById("filterBlocks");function le(e){var t=document.getElementById(e);t.setAttribute("start",0),t.setAttribute("end",125),t.dispatchEvent(new Event("change",{bubbles:!0}))}function se(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];X(e,"home",!0,!e),X(e,"away",!0,!e),e&&(document.querySelectorAll(".squadAndShots-containers-wrapper input[type=checkbox]").forEach((function(e){e.checked=y})),le("shots-time-filter")),document.querySelectorAll("a[id^=filter]:nth-of-type(-n+5)").forEach((function(t){t.style.fontWeight=e?"bold":"normal"}))}function ce(e){return"corner"==e.type?"угловой":"throw"==e.type?"аут":"freekick"==e.type?"штрафной":"goalkick"==e.type?"от ворот":""}function ue(e,t){return" Минута "+e.minute+", "+(e.good?"точно":"неточно")+(e.high?", верхом ,":", низом ,")+ce(e)+",\n\r "+t.player+"."+t.playerName}function de(e,t){var n=e.good?"blue":"red",a=document.createElement("div");a.classList.add("pass");var o=t.team+"Pass";return a.classList.add(o),a.setAttribute("player",e.player),a.setAttribute("passType",e.type),a.setAttribute("minute",e.minute),a.setAttribute("high",e.high),a.setAttribute("good",e.good),a.appendChild(function(e,t,n){var a=document.createElement("div");return a.classList.add("pass-line"),a.style.top=e.startpoint.y-1+"px",a.style.left=e.startpoint.x-1+"px",a.style.width=V(e.startpoint,e.endpoint)+"px",a.style.transform="rotate("+z(e.startpoint,e.endpoint)+"deg)",a.style.borderTopColor=n,a.addEventListener("mouseenter",(function(n){var a=document.querySelector("#one-pass-legend");a.textContent=ue(e,t),a.style.display="inline-block"})),a.addEventListener("mouseleave",(function(e){document.querySelector("#one-pass-legend").style.display="none"})),a}(e,t,n)),a.appendChild(function(e,t,n){var a=document.createElement("div");return a.classList.add("pass-start"),a.style.borderColor=n,a.style.backgroundColor=n,a.style.top=e.startpoint.y-5+"px",a.style.left=e.startpoint.x-5+"px",ce(e),a.addEventListener("mouseenter",(function(n){var a=document.querySelector("#one-pass-legend");a.textContent=ue(e,t),a.style.display="inline-block"})),a.addEventListener("mouseleave",(function(e){document.querySelector("#one-pass-legend").style.display="none"})),a}(e,t,n)),a}function pe(e,t,n,a){e.forEach((function(e,a){e[0]&&e.forEach((function(e){var o={playerName:t[a].name,team:n,player:a+1};document.querySelector("#passesboard").appendChild(de(e,o))}))}))}ie.addEventListener("click",te.bind(ie)),document.getElementsByClassName("shots-container")[0].addEventListener("click",(function(e){se()})),document.getElementById("filter-show-all").addEventListener("click",(function(e){e.preventDefault(),se()})),document.getElementById("filter-hide-all").addEventListener("click",(function(e){e.preventDefault(),se(y)}));var me,he,ye,fe,ve=60;function ge(e){for(var t=[],n=0;n<=d;n++)t.push({x:0,y:0,points:0});return e.forEach((function(e,n){var a=e.filter((function(e){return null!=e})),o=a.length;if(!(0===n||o<1)){a.forEach((function(e,a){t[n].x+=e.x/o,t[n].y+=e.y/o,t[n].points++}));var r=t.map((function(e,t){return{playerRank:t,points:e.points}})).slice(1).sort((function(e,t){return+t.points-+e.points}));t[0].order=r}})),t}function be(e,t){var n=e.ball,a={n:0,length:1e4},o={n:0,length:1e4};return e.home.forEach((function(e){var t=F(e,n,!1);t<a.length?(o.n=a.n,o.length=a.length,a.n=e.n,a.length=t):t<o.length&&(o.n=e.n,o.length=t)})),e.away.forEach((function(e){var t=F(e,n,!0);t<a.length?(o.n=a.n,o.length=a.length,a.n=e.n+d,a.length=t):t<o.length&&(o.n=e.n+d,o.length=t)})),[a,o]}Date.now();function xe(e,t,n){me.setData({max:ve*m,data:e}),he.setData({max:ve*m,data:t}),ye.setData({max:ve*p,data:n})}function we(e,t){try{var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home";s[e]=S[e].PointsFull.map((function(e){return e.slice(r,i)})),s[e].forEach((function(t,n){0!==n&&t.filter((function(e){return null!=e})).forEach((function(t){return l[e].push(t)}))}))},a=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",t=ge(s[e]).slice(),n=t[0].order,a=function(a){var o=document.getElementById(e+"AvgPoints"+a),r=n.indexOf(n.find((function(e){return e.playerRank==a})));o.style.display=r<11?"inherit":"none",o.style.left=t[a].x-5+"px",o.style.top=t[a].y-5+"px";var i=document.getElementById("both"+e+"AvgPoints"+a);i.style.display=o.style.display,i.style.left=o.style.left,i.style.top=o.style.top,document.getElementById(e+"-player-list_"+a+"_name").style.fontWeight=r<11?"bold":"normal"},o=1;o<=d;o++)a(o)},o=0==e?1:e;if(o>t||+t-+o<=f)return;var r=A[o],i=A[t],l={home:[],away:[],ball:[]},s={home:[],away:[]};l.ball=T.slice(r,i),n("home"),n("away"),xe(l.home,l.away,l.ball),a("home"),a("away")}catch(e){console.log(e)}}function Ee(){function e(e){return window.location.origin+window.location.pathname+"?"+e.replace("http://pefl.ru/tv/#/","")}var t=document.querySelector("#tv-url-input");function n(e){if(S[e].TacticPoints.length>1)for(var t=1;t<S[e].TacticPoints.length;t++)if(!(S[e].TacticPoints[t].period<f))for(var n=function(n){var a=document.querySelector("#"+e+"AvgPoints_"+t+"_"+n),o=S[e].TacticPoints[t].rankByMinutes;a.style.display=o.indexOf(o.find((function(e){return e[0]==n})))<11?"inherit":"none"},a=1;a<=d;a++)n(a)}document.getElementById("tv-url").href=window.location.href.replace("http://pefl.ru/heatmaps.html?","http://pefl.ru/tv/#/").replace(":8080//",":8080/").replace("http://localhost:8080/heatmaps.html?","http://pefl.ru/tv/#/"),document.getElementById("json-url").href=W(),document.querySelector("#updateButton").addEventListener("click",(function(n){n.preventDefault(),t.value.match(/http\:\/\/pefl.ru\/tv\/\#\/j\=\d+\&z\=.+/i)?window.location.assign(e(t.value)):alert("Вставьте корректную ссылку на ТВ матча в поле ввода!")})),document.querySelector("#newWindow").addEventListener("click",(function(n){n.preventDefault(),t.value.match(/http\:\/\/pefl.ru\/tv\/\#\/j\=\d+\&z\=.+/i)?window.open(e(t.value),"_blank"):alert("Вставьте корректную ссылку на ТВ матча в поле ввода!")})),setTimeout((function(){document.querySelector("#shots-chalkboard ~ .bojan__content").appendChild(Pe("shots",_,Q)),document.querySelector("#maps-filtered ~ .bojan__content").appendChild(Pe("maps",_,we)),document.getElementById("norm-tactic-avg").addEventListener("click",(function(e){e.preventDefault(),n("home"),n("away")})),document.getElementById("reset-maps-filtering").addEventListener("click",(function(e){e.preventDefault(),we(0,125),le("maps-time-filter")}))}),200)}function Pe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[[[0,125]],[[0,125]]],n=arguments.length>2?arguments[2]:void 0,a=document.createElement("div");function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,125],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"home",n=document.createElement("div");n.classList.add("time-slider__tacticks");var a=document.createElement("span");a.innerText="home"===t?"Тактики хозяев":"Тактики гостей",n.appendChild(a);var o=document.createElement("ul");return e.forEach((function(e){var t=document.createElement("li");t.innerText=e[0]+" - "+e[1],t.classList.add("time-slider__tacticks__ref"),t.addEventListener("click",(function(t){t.preventDefault(),c(e[0],e[1]),u()})),o.appendChild(t)})),n.appendChild(o),n}a.classList.add("time-slider"),a.id=e+"-time-filter",a.addEventListener("change",(function(e){e.preventDefault(),u()})),c(0,125);var r=document.createElement("div");r.classList.add("time-slider__inputs");var i=document.createElement("input");i.type="number",i.min=0,i.max=125,i.value=0,i.id=e+"-start-input";var l=i.cloneNode(!0);l.id=e+"-end-input",i.addEventListener("change",(function(e){var t;e.preventDefault(),+this.value>+a.getAttribute("end")-3&&(this.value=+a.getAttribute("end")-3),t=this.value,a.setAttribute("start",t),u()})),l.addEventListener("change",(function(e){var t;e.preventDefault(),+this.value<+a.getAttribute("start")+3&&(this.value=+a.getAttribute("start")+3),t=this.value,a.setAttribute("end",t),u()}));var s=document.createElement("span");function c(e,t){a.setAttribute("start",e),a.setAttribute("end",t)}function u(){var e=+a.getAttribute("start"),t=+a.getAttribute("end");i.value=e,l.value=t,n(e,t)}return s.innerText="Границы периода",r.appendChild(i),r.appendChild(s),r.appendChild(l),t[0].length>0&&a.appendChild(o(t[0])),t[1].length>0&&a.appendChild(o(t[1],"away")),a.appendChild(r),u(),a}window.onload=function(){var e=new XMLHttpRequest;e.overrideMimeType("application/json"),e.onreadystatechange=function(){if(this.readyState==this.OPENED&&e.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),4==this.readyState){if(200==this.status){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.65,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s;return h337.create({container:document.querySelector(e),maxOpacity:a,minOpacity:n,radius:u*t})},n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home";if(document.querySelector("#"+e+"-tacticks-heatmaps + .bojan__label .bojan__label__header").textContent="Смены тактик "+fe[e].team.name,S[e].TacticPoints.length>1)for(var t=function(t){if(S[e].TacticPoints[t].period<f)return"continue";S[e].TacticPoints[t].rankByMinutes=[],S[e].TacticPoints[t].averages.forEach((function(n,a){var o=n.length;S[e].TacticPoints[t].rankByMinutes[a]=[a,o],0===a||o<2||n.forEach((function(e,t,a){n[0].x+=e.x/o,n[0].y+=e.y/o}))})),S[e].TacticPoints[t].rankByMinutes.sort((function(e,t){return t[1]-e[1]}));var n=document.getElementsByClassName("heatmap2-containers-wrapper")[0].cloneNode(!0),a="#heatmap-tactic"+e+t,o="#heatmap-ball"+e+t,r=(S[e].TacticPoints[t].start>0?"от "+S[e].TacticPoints[t].start:"")+" "+(S[e].TacticPoints[t].end<125?"до "+S[e].TacticPoints[t].end:"")+".  "+fe[e].team.name;n.querySelector("#heatmap-home").id="heatmap-tactic"+e+t,n.querySelector(a+" > div").textContent="Игроки "+r,n.querySelector("#heatmap-away").id="heatmap-ball"+e+t,n.querySelector(o+" > div").textContent="Мяч "+r,document.querySelector("#"+e+"-tacticks-heatmaps ~ .bojan__content").appendChild(n);var i=document.getElementsByClassName("heatmap-container-wrapper")[1].cloneNode(!0);i.className="heatmap-container-wrapper",n.className="heatmap3-containers-wrapper",i.querySelector(".heatmap-container").id="avgPositions"+I(e)+t,i.querySelector(".heatmap-container > div").textContent="Ср.поз."+r,n.appendChild(i);for(var l=function(n){var a=document.querySelector("#player_default_"+e).cloneNode(!0);a.id=e+"AvgPoints_"+t+"_"+n;var o=S[e].TacticPoints[t].rankByMinutes;a.style.display=o.indexOf(o.find((function(e){return e[0]==n})))<11?"inherit":"none",a.style.left=S[e].TacticPoints[t].averages[n][0].x-5+"px",a.style.top=S[e].TacticPoints[t].averages[n][0].y-5+"px",a.querySelector(".player_number").textContent=fe[e].players[n-1].number,a.querySelector(".tooltiptext").textContent=fe[e].players[n-1].name+"    "+fe[e].players[n-1].number,document.querySelector("#avgPositions"+I(e)+t).appendChild(a)},m=1;m<=d;m++)l(m);h337.create({container:document.querySelector(a),maxOpacity:s,minOpacity:c,radius:u}).setData({max:ve,data:S[e].TacticPoints[t].team}),h337.create({container:document.querySelector(o),maxOpacity:s,minOpacity:c,radius:.67*u*1.1}).setData({max:ve*p*.35,data:S[e].TacticPoints[t].ball})},n=1;n<S[e].TacticPoints.length;n++)t(n);_.push(S[e].TacticPoints.filter((function(e,t){return t>0&&e.period>3})).map((function(e){return[e.start,e.end]})))},o=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=e||"home",r=t||1,i=n||S.home.TacticPoints,l=o+"AvgPoints"+r,s="both"+o+"AvgPoints"+r,c=document.getElementById(l).style,u=document.getElementById(s).style;if(c.display=a?"inherit":"none",u.display=a?"inherit":"none",i.length>1)for(var d=1;d<i.length;d++)if(!(i[d].period<f)){var p=o+"AvgPoints_"+d+"_"+r;document.getElementById(p).style.display=a?"inherit":"none"}},r=function(e){for(var t=1;t<=d;t++){var n=document.querySelector("#player_default_"+e).cloneNode(!0);n.id=e+"AvgPoints"+t,n.plId=("home"===e?"hm":"aw")+t;var a=e+"-player-list_"+t,r=document.createElement("div");r.className="playerRow",r.id=a;var i=document.createElement("div");i.innerText=fe[e].players[t-1].number+". ",i.className="player-list-num";var l=document.createElement("div");l.className="player-list-name";var s=document.createElement("a");s.id=a+"_name",s.innerText=fe[e].players[t-1].name,s.href="#",s.addEventListener("click",(function(t){t.preventDefault(),this.style.fontWeight="bold"==this.style.fontWeight?"normal":"bold",o(e,this.id.replace(e+"-player-list_","").replace("_name",""),S[e].TacticPoints,"bold"==this.style.fontWeight||y)})),fe[e].players[t-1].sub&&s.appendChild((q=fe[e].players[t-1].sub,B=void 0,_=void 0,B=(q||h)==h?"http://pefl.ru/system/img/gm/out.gif":"http://pefl.ru/system/img/gm/in.gif",(_=document.createElement("img")).src=B,_)),l.appendChild(s),r.appendChild(i),r.appendChild(l);var c=document.createElement("div");c.className="player-list-eye",c.innerText=" ",r.appendChild(c);var u=document.createElement("div");u.className="player-list-shots";var p=(x=fe[e].players[t-1],w=void 0,E=void 0,P=void 0,C=void 0,k=void 0,T=void 0,A=void 0,w=x.autogoals?""+-parseInt(x.autogoals):"",E=x.goals?parseInt(x.goals):0,P=E+(x.stvor?parseInt(x.stvor):0),C=P+(x.miss?parseInt(x.miss):0),k="|"+E+w,T=x.bar?"|"+parseInt(x.bar):" ",A=x.block?"|"+parseInt(x.block):" ",C+T+A==0&&""==w?" ":0==C?"        "+w+A+T:(C>9?C:" "+C)+"|"+P+k+" "+A+T);u.innerText=p;var m=document.createElement("div");if(m.className="playerShotCheckbox"," "==p)m.innerText=" ";else{m.appendChild(ee({player:t,team:e}));var f=document.createElement("div");f.className="tooltiptext",f.innerText="Удары|В створ|Голы-автоголы   |Блокированные|Каркас",u.appendChild(f)}r.appendChild(m),r.appendChild(u);var v=document.createElement("div");v.className="player-list-mileage",v.innerText=Number(S[e].Mileage[t]/1e3).toFixed(2)+"км",r.appendChild(v),document.querySelector("#squad"+I(e)).appendChild(r),n.querySelector(".player_number").textContent=fe[e].players[t-1].number,n.querySelector(".tooltiptext").textContent=fe[e].players[t-1].name+"    "+fe[e].players[t-1].number,document.getElementById("heatmap-avg"+I(e)).appendChild(n);var g=n.cloneNode(!0);g.id="both"+g.id,document.getElementById("heatmap-avgBoth").appendChild(g);var b=n.cloneNode(!0);b.style.display=S[e].AvgPoints[t].x>8&&S[e].AvgPoints[t].y>8?"inherit":"none",b.id=b.id+"_individual",b.style.left=S[e].AvgPoints[t].x-5+"px",b.style.top=S[e].AvgPoints[t].y-5+"px",document.querySelector("#heatmap-"+e+t).appendChild(b)}var x,w,E,P,C,k,T,A,q,B,_},l=this.responseText.match(P),m=l?l.pop():["0:0"];fe=JSON.parse(this.responseText),Z=document.querySelector("#player_default_away .player_shape").style,X=document.querySelector("#player_default_home .player_shape").style,Z.backgroundColor="#"+fe.away.team.back,Z.borderColor="#"+fe.away.team.color,Z.color="#"+fe.away.team.color,X.color="#"+fe.home.team.color,X.borderColor="#"+fe.home.team.color,X.backgroundColor="#"+fe.home.team.back;var b=fe.game;console.log("rep  - ",fe);var k={corner:!1,throwIn:!1,deadBall:!1,goalKick:!1,center:!0,team:0,ballOwner:0},I=function(e){return"home"===e?"Home":"Away"};b.slice(1,-1);var N="0:0",j=null;try{b.forEach((function(e,t,n){var a,o=n[t-1];e.C&&(k.corner=!0,k.team=e.C),e.A&&(k.throwIn=!0,k.team=e.A),e.F&&(k.deadBall=!0,k.team=e.F),e.T&&(k.goalKick=!0,k.team=e.T.team),e.N&&(k.center=!0,k.team=e.N);var r,l,s,c,u=[],p=[];if(e.coordinates&&t>0){var m=function(){j.start=null},y=function(t){j={start:{ball:i({},e.coordinates.ball),player:t.n}}};try{p=o.coordinates&&be(o.coordinates),u=be(e.coordinates),r=u[0],c=u[1],l=p&&p[0],s=p&&p[1];(function(){if(D)m();else{if(j&&j.start||!r||0!==r.length)return e.G?(m(),void console.log(" ShotElement  playersCloseToBall - ",u,p,e)):void(!(!l||!r)&&0===r.length&&0===l.length&&l.n===r.n&&c.length>0&&s.length>0&&y(r));y(r)}})()}catch(t){console.log("closest players error",t,e)}}function f(t,n){return e.messages[t].mes.match(n)}if(e.interval&&parseInt(e.interval),A[e.minute]||(A[e.minute]=S.home.Points[1].length),e.S&&(1==e.S.team?(fe.home.players[e.S.in-1].sub=2,fe.home.players[e.S.out-1].sub=h):(fe.away.players[e.S.in-1].sub=2,fe.away.players[e.S.out-1].sub=h)),e.messages[0]){var b,P,_={},O=!1;try{if(e.coordinates){try{k.center&&e.messages&&e.messages.some((function(e){return e.mes.match(x)}))&&(k.center=!1,l.n)}catch(t){console.log(" N error",t,e)}var I=e.coordinates.ball,M=o.coordinates?o.coordinates.ball:void 0,W={x:I.w,y:I.h};if(k.corner&&e.messages[1]){_.endpoint=U(W,G,v,g),_.high=1===I.z,_.minute=e.minute,_.episode=e.num,_.type="corner",k.corner=!1;var V={x:M.w,y:M.h};b=R(e.messages[0]),_.startpoint=U(V,G,v,g),e.messages[2]?(P=R(e.messages[2]),_.good=K(P,b)):(_.good=!0,P=R(e.messages[1])),P,_.player=b,L[b].push(_)}else if(k.throwIn&&e.messages[0]){_.endpoint=U(W,G,v,g),_.high=1===I.z,_.minute=e.minute,_.episode=e.num,_.type="throw",k.throwIn=!1,(b=R(o.messages[o.messages.length-1]))||(o=n[t-2]),(b=R(o.messages[o.messages.length-1]))||(o=n[t-3]);var F={x:(M=o.coordinates.ball).w,y:M.h};b=R(o.messages[o.messages.length-1]),_.startpoint=U(F,G,v,g),P=R(e.messages[e.messages.length-1]),_.good=K(P,b),P,_.player=b,L[b].push(_)}else if(k.deadBall)k.deadBall=!1;else if(k.goalKick){_.endpoint=U(W,G,v,g),_.high=1===I.z,_.minute=e.minute,_.episode=e.num,O=!0,_.type="goalkick";var z={x:M.w,y:M.h};if(k.goalKick=!1,b=l.n,_.startpoint=U(z,G,v,g),e.messages[0]&&(f(0,w)&&(e.messages[1]?(P=+f(1,C)[0],_.good=K(b,P)):O=!0),"goalkick"===_.type&&O)){var Z=+f(0,C)[0];_.good=f(0,w)||Z,O=!1}_.player=b,L[b].push(_)}}}catch(t){console.log("error ",o),console.log("Что то не так с обсчетом паса",e.minute,e.n,t)}if(e.messages.forEach((function(e){e.mes.indexOf(" СЧЕТ ")>-1&&(N=e.mes.replace(" СЧЕТ ",""))})),"Серия пенальти!..."==e.messages[0].mes||"Матч переходит к послематчевым одиннадцатиметровым!..."==e.messages[0].mes||"Назначаются послематчевые пенальти!..."==e.messages[0].mes)throw D=!0,"Серия пенальти!..."}if(e.ZT){var $=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home";S[t].TacticPoints[0].end=e.minute,S[t].TacticPoints[0].period=e.minute-S[t].TacticPoints[0].start,S[t].TacticPoints.push(S[t].TacticPoints[0]),S[t].TacticPoints[0]={start:e.minute,end:125,period:125-e.minute,team:[],ball:[],averages:[]},S[t].TacticChanges.push(S[t].Points[0].length);for(var n=0;n<=d;n++)S[t].TacticPoints[0].averages.push([{x:0,y:0}])};1==e.ZT.team?($("home"),S.home.TacticChanges.push(S.home.Points[0].length)):$("away")}try{if((e.U||e.W)&&!D){var J=e.coordinates.ball,X={x:J.w,y:J.h,value:1},Q=e.G?"G":e.V?"V":e.W?"W":e.B?"B":e.U.team>2?"Block":"U",Y=n[t-1].coordinates?n[t-1].coordinates.ball:n[t-2].coordinates?n[t-2].coordinates.ball:n[t-3].coordinates?n[t-3].coordinates.ball:n[t-4].coordinates.ball,ee={x:Y.w,y:Y.h,value:1},te={endpoint:U(X,G,v,g),startpoint:U(ee,G,v,g),episode:t,type:Q,minute:e.minute,player:e.U?e.U.player:e.W.player,xG:e.U?e.U.xG?e.U.xG:"ждем xG":e.W.xG?e.W.xG:"ждем xG"};e.U&&(1==e.U.team||3==e.U.team)||e.W&&(2==e.W.team||4==e.W.team)?B.home.push(te):B.away.push(te)}if((e.G||e.V||e.B)&&!e.U){var ne=e.coordinates.ball;console.log("goal event in next episode -  min=",e.minute," U=",e.U," W=",e.W," V=",e.V," G=",e.G," B=",e.B,ne);var ae,oe=U({x:ne.w,y:ne.h,value:1},G,v,g);ae=e.G&&(1==e.G.team||3==e.G.team)||e.V&&(1==e.V.team||3==e.V.team)||e.B&&(1==e.B.team||3==e.B.team)?B.home[B.home.length-1]:B.away[B.away.length-1],n[t-1].messages.length>0&&n[t-1].messages.some((function(e){return e.mes.match(E)}))&&(ae.startpoint=ae.endpoint),ae.type=e.G?"G":e.V?"V":"B",ae.endpoint=oe,ae.player=e.G?e.G.player:e.V?e.V.player:e.B.player}}catch(a){console.log("Что то не так с обсчетом удара",e.minute,e.n,a),console.log(e,n[t-1],n[t-2])}function re(e,t){for(var n=1;n<=d;n++)e[n].push(t[n])}if(e.M&&(G=!G),e.coordinates){var ie=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",n=e.coordinates[t],o=[],r=0;r<=d;r++)o.push(null);n.forEach((function(e){if(a=1==e.n?{x:e.w,y:e.h,value:.2}:{x:e.w,y:e.h,value:1},e.n<=d){var n=U(a,"home"===t?G:!G);if(S[t].Points[e.n].push(n),S[t].Points[0].push(n),S[t].TacticPoints[0].team.push(n),S[t].TacticPoints[0].averages[e.n].push(n),S[t].Points[e.n].length>1){var r=S[t].Points[e.n].length-1;S[t].Mileage[e.n]+=H(S[t].Points[e.n][r],S[t].Points[e.n][r-1])}o[e.n]=n}else q[t].push(e)})),S[t].TacticPoints[0].ball.push(se),re(S[t].PointsFull,o)},le=e.coordinates.ball,se=U({x:le.w,y:le.h,value:1},G);T.push(se),ie("home"),ie("away")}}))}catch(e){console.log("game.forEach ",e)}S.home.TacticPoints.push(S.home.TacticPoints[0]),S.away.TacticPoints.push(S.away.TacticPoints[0]);var M=N+(m==N?"":"(".concat(function(e,t){var n=e.split(":"),a=t.split(":");return"".concat(a[0]-n[0],":").concat(a[1]-n[1])}(N,m),")")),W=fe.date+". "+(fe.stadium.city?fe.stadium.city+". ":"")+fe.stadium.name+". "+fe.home.team.name+" - "+fe.away.team.name+" "+M;document.querySelector("#game-info").textContent=W,console.log("oldpasses -",L),console.log("passes -",O);var V=L.reduce((function(e,t,n){var o=t.filter((function(e){return"goalkick"===e.type}));return o[0]?[].concat(a(e),a(o)):a(e)}),[]);console.log("gkPasses   ",V),B.home.forEach((function(e){J(e.type,fe.home.players[e.player-1])})),B.away.forEach((function(e){J(e.type,fe.away.players[e.player-1])})),me=t("#heatmap-home"),he=t("#heatmap-away"),ye=t("#heatmap-ball",.67),xe(S.home.PointsFull,S.away.PointsFull,T),t("#heatmap-avgHome"),t("#heatmap-avgAway"),t("#chalkboard"),t("#heatmap-avgBoth"),t("#passesboard");n("home"),n("away"),setTimeout((function(){for(var e=function(e){var t=document.getElementsByClassName("heatmap2-containers-wrapper")[0].cloneNode(!0);function n(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",a="#heatmap-"+n+e;t.querySelector("#heatmap-"+n).id="heatmap-"+n+e,t.querySelector(a+" > div").textContent=fe[n].players[e-1].number+". "+fe[n].players[e-1].name,"home"===n&&document.querySelector("#separate-heatmaps ~ .bojan__content").appendChild(t),h337.create({container:document.querySelector(a),maxOpacity:s,minOpacity:c,radius:u}).setData({max:ve,data:S[n].Points[e]})}n("home"),n("away")},t=1;t<=d;t++)e(t)}),10),document.querySelector("#heatmap-home .overlay").textContent=fe.home.team.name,document.querySelector("#heatmap-away .overlay").textContent=fe.away.team.name,document.querySelector("#heatmap-avgHome .overlay").textContent="Средние позиции "+fe.home.team.name,document.querySelector("#heatmap-avgAway .overlay").textContent="Средние позиции "+fe.away.team.name,S.home.TacticChanges.push(S.home.Points[0].length-1),S.away.TacticChanges.push(S.away.Points[0].length-1),S.home.AvgPoints=ge(S.home.Points).slice(),S.away.AvgPoints=ge(S.away.Points).slice(),setTimeout((function(){r("home"),r("away")}),50),setTimeout((function(){document.body.removeChild(document.querySelector(".loader-wrapper"))}),200);var F=document.querySelector("#chalkboard .heatmap-canvas"),z=document.querySelector("#passesboard .heatmap-canvas");if(F.getContext){F.getContext("2d");$(B.away,fe.away.players,"away"),$(B.home,fe.home.players,"home")}if(z.getContext){z.getContext("2d");pe(L.slice(19),fe.away.players,"away"),pe(L.slice(1,18),fe.home.players,"home")}}else alert("Вставьте верно ссылку на матч!");setTimeout(Ee,200)}var Z,X},e.open("GET",W("http://pefl.ru/tv/#/j=1099079&z=c3121c566116e3f04f0fba27f99d502c"),!0),e.send()}},{}]},{},[1]);
/*
 * heatmap.js v2.0.5 | JavaScript Heatmap Library
 *
 * Copyright 2008-2016 Patrick Wied <heatmapjs@patrick-wied.at> - All rights reserved.
 * Dual licensed under MIT and Beerware license 
 *
 * :: 2016-09-05 01:16
 */
(function (a, b, c) { if (typeof module !== "undefined" && module.exports) { module.exports = c() } else if (typeof define === "function" && define.amd) { define(c) } else { b[a] = c() } })("h337", this, function () { var a = { defaultRadius: 40, defaultRenderer: "canvas2d", defaultGradient: { .25: "rgb(0,0,255)", .55: "rgb(0,255,0)", .85: "yellow", 1: "rgb(255,0,0)" }, defaultMaxOpacity: 1, defaultMinOpacity: 0, defaultBlur: .85, defaultXField: "x", defaultYField: "y", defaultValueField: "value", plugins: {} }; var b = function h() { var b = function d(a) { this._coordinator = {}; this._data = []; this._radi = []; this._min = 10; this._max = 1; this._xField = a["xField"] || a.defaultXField; this._yField = a["yField"] || a.defaultYField; this._valueField = a["valueField"] || a.defaultValueField; if (a["radius"]) { this._cfgRadius = a["radius"] } }; var c = a.defaultRadius; b.prototype = { _organiseData: function (a, b) { var d = a[this._xField]; var e = a[this._yField]; var f = this._radi; var g = this._data; var h = this._max; var i = this._min; var j = a[this._valueField] || 1; var k = a.radius || this._cfgRadius || c; if (!g[d]) { g[d] = []; f[d] = [] } if (!g[d][e]) { g[d][e] = j; f[d][e] = k } else { g[d][e] += j } var l = g[d][e]; if (l > h) { if (!b) { this._max = l } else { this.setDataMax(l) } return false } else if (l < i) { if (!b) { this._min = l } else { this.setDataMin(l) } return false } else { return { x: d, y: e, value: j, radius: k, min: i, max: h } } }, _unOrganizeData: function () { var a = []; var b = this._data; var c = this._radi; for (var d in b) { for (var e in b[d]) { a.push({ x: d, y: e, radius: c[d][e], value: b[d][e] }) } } return { min: this._min, max: this._max, data: a } }, _onExtremaChange: function () { this._coordinator.emit("extremachange", { min: this._min, max: this._max }) }, addData: function () { if (arguments[0].length > 0) { var a = arguments[0]; var b = a.length; while (b--) { this.addData.call(this, a[b]) } } else { var c = this._organiseData(arguments[0], true); if (c) { if (this._data.length === 0) { this._min = this._max = c.value } this._coordinator.emit("renderpartial", { min: this._min, max: this._max, data: [c] }) } } return this }, setData: function (a) { var b = a.data; var c = b.length; this._data = []; this._radi = []; for (var d = 0; d < c; d++) { this._organiseData(b[d], false) } this._max = a.max; this._min = a.min || 0; this._onExtremaChange(); this._coordinator.emit("renderall", this._getInternalData()); return this }, removeData: function () { }, setDataMax: function (a) { this._max = a; this._onExtremaChange(); this._coordinator.emit("renderall", this._getInternalData()); return this }, setDataMin: function (a) { this._min = a; this._onExtremaChange(); this._coordinator.emit("renderall", this._getInternalData()); return this }, setCoordinator: function (a) { this._coordinator = a }, _getInternalData: function () { return { max: this._max, min: this._min, data: this._data, radi: this._radi } }, getData: function () { return this._unOrganizeData() } }; return b }(); var c = function i() { var a = function (a) { var b = a.gradient || a.defaultGradient; var c = document.createElement("canvas"); var d = c.getContext("2d"); c.width = 256; c.height = 1; var e = d.createLinearGradient(0, 0, 256, 1); for (var f in b) { e.addColorStop(f, b[f]) } d.fillStyle = e; d.fillRect(0, 0, 256, 1); return d.getImageData(0, 0, 256, 1).data }; var b = function (a, b) { var c = document.createElement("canvas"); var d = c.getContext("2d"); var e = a; var f = a; c.width = c.height = a * 2; if (b == 1) { d.beginPath(); d.arc(e, f, a, 0, 2 * Math.PI, false); d.fillStyle = "rgba(0,0,0,1)"; d.fill() } else { var g = d.createRadialGradient(e, f, a * b, e, f, a); g.addColorStop(0, "rgba(0,0,0,1)"); g.addColorStop(1, "rgba(0,0,0,0)"); d.fillStyle = g; d.fillRect(0, 0, 2 * a, 2 * a) } return c }; var c = function (a) { var b = []; var c = a.min; var d = a.max; var e = a.radi; var a = a.data; var f = Object.keys(a); var g = f.length; while (g--) { var h = f[g]; var i = Object.keys(a[h]); var j = i.length; while (j--) { var k = i[j]; var l = a[h][k]; var m = e[h][k]; b.push({ x: h, y: k, value: l, radius: m }) } } return { min: c, max: d, data: b } }; function d(b) { var c = b.container; var d = this.shadowCanvas = document.createElement("canvas"); var e = this.canvas = b.canvas || document.createElement("canvas"); var f = this._renderBoundaries = [1e4, 1e4, 0, 0]; var g = getComputedStyle(b.container) || {}; e.className = "heatmap-canvas"; this._width = e.width = d.width = b.width || +g.width.replace(/px/, ""); this._height = e.height = d.height = b.height || +g.height.replace(/px/, ""); this.shadowCtx = d.getContext("2d"); this.ctx = e.getContext("2d"); e.style.cssText = d.style.cssText = "position:absolute;left:0;top:0;"; c.style.position = "relative"; c.appendChild(e); this._palette = a(b); this._templates = {}; this._setStyles(b) } d.prototype = { renderPartial: function (a) { if (a.data.length > 0) { this._drawAlpha(a); this._colorize() } }, renderAll: function (a) { this._clear(); if (a.data.length > 0) { this._drawAlpha(c(a)); this._colorize() } }, _updateGradient: function (b) { this._palette = a(b) }, updateConfig: function (a) { if (a["gradient"]) { this._updateGradient(a) } this._setStyles(a) }, setDimensions: function (a, b) { this._width = a; this._height = b; this.canvas.width = this.shadowCanvas.width = a; this.canvas.height = this.shadowCanvas.height = b }, _clear: function () { this.shadowCtx.clearRect(0, 0, this._width, this._height); this.ctx.clearRect(0, 0, this._width, this._height) }, _setStyles: function (a) { this._blur = a.blur == 0 ? 0 : a.blur || a.defaultBlur; if (a.backgroundColor) { this.canvas.style.backgroundColor = a.backgroundColor } this._width = this.canvas.width = this.shadowCanvas.width = a.width || this._width; this._height = this.canvas.height = this.shadowCanvas.height = a.height || this._height; this._opacity = (a.opacity || 0) * 255; this._maxOpacity = (a.maxOpacity || a.defaultMaxOpacity) * 255; this._minOpacity = (a.minOpacity || a.defaultMinOpacity) * 255; this._useGradientOpacity = !!a.useGradientOpacity }, _drawAlpha: function (a) { var c = this._min = a.min; var d = this._max = a.max; var a = a.data || []; var e = a.length; var f = 1 - this._blur; while (e--) { var g = a[e]; var h = g.x; var i = g.y; var j = g.radius; var k = Math.min(g.value, d); var l = h - j; var m = i - j; var n = this.shadowCtx; var o; if (!this._templates[j]) { this._templates[j] = o = b(j, f) } else { o = this._templates[j] } var p = (k - c) / (d - c); n.globalAlpha = p < .01 ? .01 : p; n.drawImage(o, l, m); if (l < this._renderBoundaries[0]) { this._renderBoundaries[0] = l } if (m < this._renderBoundaries[1]) { this._renderBoundaries[1] = m } if (l + 2 * j > this._renderBoundaries[2]) { this._renderBoundaries[2] = l + 2 * j } if (m + 2 * j > this._renderBoundaries[3]) { this._renderBoundaries[3] = m + 2 * j } } }, _colorize: function () { var a = this._renderBoundaries[0]; var b = this._renderBoundaries[1]; var c = this._renderBoundaries[2] - a; var d = this._renderBoundaries[3] - b; var e = this._width; var f = this._height; var g = this._opacity; var h = this._maxOpacity; var i = this._minOpacity; var j = this._useGradientOpacity; if (a < 0) { a = 0 } if (b < 0) { b = 0 } if (a + c > e) { c = e - a } if (b + d > f) { d = f - b } var k = this.shadowCtx.getImageData(a, b, c, d); var l = k.data; var m = l.length; var n = this._palette; for (var o = 3; o < m; o += 4) { var p = l[o]; var q = p * 4; if (!q) { continue } var r; if (g > 0) { r = g } else { if (p < h) { if (p < i) { r = i } else { r = p } } else { r = h } } l[o - 3] = n[q]; l[o - 2] = n[q + 1]; l[o - 1] = n[q + 2]; l[o] = j ? n[q + 3] : r } k.data = l; this.ctx.putImageData(k, a, b); this._renderBoundaries = [1e3, 1e3, 0, 0] }, getValueAt: function (a) { var b; var c = this.shadowCtx; var d = c.getImageData(a.x, a.y, 1, 1); var e = d.data[3]; var f = this._max; var g = this._min; b = Math.abs(f - g) * (e / 255) >> 0; return b }, getDataURL: function () { return this.canvas.toDataURL() } }; return d }(); var d = function j() { var b = false; if (a["defaultRenderer"] === "canvas2d") { b = c } return b }(); var e = { merge: function () { var a = {}; var b = arguments.length; for (var c = 0; c < b; c++) { var d = arguments[c]; for (var e in d) { a[e] = d[e] } } return a } }; var f = function k() { var c = function h() { function a() { this.cStore = {} } a.prototype = { on: function (a, b, c) { var d = this.cStore; if (!d[a]) { d[a] = [] } d[a].push(function (a) { return b.call(c, a) }) }, emit: function (a, b) { var c = this.cStore; if (c[a]) { var d = c[a].length; for (var e = 0; e < d; e++) { var f = c[a][e]; f(b) } } } }; return a }(); var f = function (a) { var b = a._renderer; var c = a._coordinator; var d = a._store; c.on("renderpartial", b.renderPartial, b); c.on("renderall", b.renderAll, b); c.on("extremachange", function (b) { a._config.onExtremaChange && a._config.onExtremaChange({ min: b.min, max: b.max, gradient: a._config["gradient"] || a._config["defaultGradient"] }) }); d.setCoordinator(c) }; function g() { var g = this._config = e.merge(a, arguments[0] || {}); this._coordinator = new c; if (g["plugin"]) { var h = g["plugin"]; if (!a.plugins[h]) { throw new Error("Plugin '" + h + "' not found. Maybe it was not registered.") } else { var i = a.plugins[h]; this._renderer = new i.renderer(g); this._store = new i.store(g) } } else { this._renderer = new d(g); this._store = new b(g) } f(this) } g.prototype = { addData: function () { this._store.addData.apply(this._store, arguments); return this }, removeData: function () { this._store.removeData && this._store.removeData.apply(this._store, arguments); return this }, setData: function () { this._store.setData.apply(this._store, arguments); return this }, setDataMax: function () { this._store.setDataMax.apply(this._store, arguments); return this }, setDataMin: function () { this._store.setDataMin.apply(this._store, arguments); return this }, configure: function (a) { this._config = e.merge(this._config, a); this._renderer.updateConfig(this._config); this._coordinator.emit("renderall", this._store._getInternalData()); return this }, repaint: function () { this._coordinator.emit("renderall", this._store._getInternalData()); return this }, getData: function () { return this._store.getData() }, getDataURL: function () { return this._renderer.getDataURL() }, getValueAt: function (a) { if (this._store.getValueAt) { return this._store.getValueAt(a) } else if (this._renderer.getValueAt) { return this._renderer.getValueAt(a) } else { return null } } }; return g }(); var g = { create: function (a) { return new f(a) }, register: function (b, c) { a.plugins[b] = c } }; return g });
//# sourceMappingURL=hm.js.map
