/*
 * heatmap.js v2.0.5 | JavaScript Heatmap Library
 *
 * Copyright 2008-2016 Patrick Wied <heatmapjs@patrick-wied.at> - All rights reserved.
 * Dual licensed under MIT and Beerware license 
 *
 * :: 2016-09-05 01:16
 */
(function(a,b,c){if(typeof module!=="undefined"&&module.exports){module.exports=c()}else if(typeof define==="function"&&define.amd){define(c)}else{b[a]=c()}})("h337",this,function(){var a={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}};var b=function h(){var b=function d(a){this._coordinator={};this._data=[];this._radi=[];this._min=10;this._max=1;this._xField=a["xField"]||a.defaultXField;this._yField=a["yField"]||a.defaultYField;this._valueField=a["valueField"]||a.defaultValueField;if(a["radius"]){this._cfgRadius=a["radius"]}};var c=a.defaultRadius;b.prototype={_organiseData:function(a,b){var d=a[this._xField];var e=a[this._yField];var f=this._radi;var g=this._data;var h=this._max;var i=this._min;var j=a[this._valueField]||1;var k=a.radius||this._cfgRadius||c;if(!g[d]){g[d]=[];f[d]=[]}if(!g[d][e]){g[d][e]=j;f[d][e]=k}else{g[d][e]+=j}var l=g[d][e];if(l>h){if(!b){this._max=l}else{this.setDataMax(l)}return false}else if(l<i){if(!b){this._min=l}else{this.setDataMin(l)}return false}else{return{x:d,y:e,value:j,radius:k,min:i,max:h}}},_unOrganizeData:function(){var a=[];var b=this._data;var c=this._radi;for(var d in b){for(var e in b[d]){a.push({x:d,y:e,radius:c[d][e],value:b[d][e]})}}return{min:this._min,max:this._max,data:a}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0){var a=arguments[0];var b=a.length;while(b--){this.addData.call(this,a[b])}}else{var c=this._organiseData(arguments[0],true);if(c){if(this._data.length===0){this._min=this._max=c.value}this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[c]})}}return this},setData:function(a){var b=a.data;var c=b.length;this._data=[];this._radi=[];for(var d=0;d<c;d++){this._organiseData(b[d],false)}this._max=a.max;this._min=a.min||0;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},removeData:function(){},setDataMax:function(a){this._max=a;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},setDataMin:function(a){this._min=a;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},setCoordinator:function(a){this._coordinator=a},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}};return b}();var c=function i(){var a=function(a){var b=a.gradient||a.defaultGradient;var c=document.createElement("canvas");var d=c.getContext("2d");c.width=256;c.height=1;var e=d.createLinearGradient(0,0,256,1);for(var f in b){e.addColorStop(f,b[f])}d.fillStyle=e;d.fillRect(0,0,256,1);return d.getImageData(0,0,256,1).data};var b=function(a,b){var c=document.createElement("canvas");var d=c.getContext("2d");var e=a;var f=a;c.width=c.height=a*2;if(b==1){d.beginPath();d.arc(e,f,a,0,2*Math.PI,false);d.fillStyle="rgba(0,0,0,1)";d.fill()}else{var g=d.createRadialGradient(e,f,a*b,e,f,a);g.addColorStop(0,"rgba(0,0,0,1)");g.addColorStop(1,"rgba(0,0,0,0)");d.fillStyle=g;d.fillRect(0,0,2*a,2*a)}return c};var c=function(a){var b=[];var c=a.min;var d=a.max;var e=a.radi;var a=a.data;var f=Object.keys(a);var g=f.length;while(g--){var h=f[g];var i=Object.keys(a[h]);var j=i.length;while(j--){var k=i[j];var l=a[h][k];var m=e[h][k];b.push({x:h,y:k,value:l,radius:m})}}return{min:c,max:d,data:b}};function d(b){var c=b.container;var d=this.shadowCanvas=document.createElement("canvas");var e=this.canvas=b.canvas||document.createElement("canvas");var f=this._renderBoundaries=[1e4,1e4,0,0];var g=getComputedStyle(b.container)||{};e.className="heatmap-canvas";this._width=e.width=d.width=b.width||+g.width.replace(/px/,"");this._height=e.height=d.height=b.height||+g.height.replace(/px/,"");this.shadowCtx=d.getContext("2d");this.ctx=e.getContext("2d");e.style.cssText=d.style.cssText="position:absolute;left:0;top:0;";c.style.position="relative";c.appendChild(e);this._palette=a(b);this._templates={};this._setStyles(b)}d.prototype={renderPartial:function(a){if(a.data.length>0){this._drawAlpha(a);this._colorize()}},renderAll:function(a){this._clear();if(a.data.length>0){this._drawAlpha(c(a));this._colorize()}},_updateGradient:function(b){this._palette=a(b)},updateConfig:function(a){if(a["gradient"]){this._updateGradient(a)}this._setStyles(a)},setDimensions:function(a,b){this._width=a;this._height=b;this.canvas.width=this.shadowCanvas.width=a;this.canvas.height=this.shadowCanvas.height=b},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height);this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(a){this._blur=a.blur==0?0:a.blur||a.defaultBlur;if(a.backgroundColor){this.canvas.style.backgroundColor=a.backgroundColor}this._width=this.canvas.width=this.shadowCanvas.width=a.width||this._width;this._height=this.canvas.height=this.shadowCanvas.height=a.height||this._height;this._opacity=(a.opacity||0)*255;this._maxOpacity=(a.maxOpacity||a.defaultMaxOpacity)*255;this._minOpacity=(a.minOpacity||a.defaultMinOpacity)*255;this._useGradientOpacity=!!a.useGradientOpacity},_drawAlpha:function(a){var c=this._min=a.min;var d=this._max=a.max;var a=a.data||[];var e=a.length;var f=1-this._blur;while(e--){var g=a[e];var h=g.x;var i=g.y;var j=g.radius;var k=Math.min(g.value,d);var l=h-j;var m=i-j;var n=this.shadowCtx;var o;if(!this._templates[j]){this._templates[j]=o=b(j,f)}else{o=this._templates[j]}var p=(k-c)/(d-c);n.globalAlpha=p<.01?.01:p;n.drawImage(o,l,m);if(l<this._renderBoundaries[0]){this._renderBoundaries[0]=l}if(m<this._renderBoundaries[1]){this._renderBoundaries[1]=m}if(l+2*j>this._renderBoundaries[2]){this._renderBoundaries[2]=l+2*j}if(m+2*j>this._renderBoundaries[3]){this._renderBoundaries[3]=m+2*j}}},_colorize:function(){var a=this._renderBoundaries[0];var b=this._renderBoundaries[1];var c=this._renderBoundaries[2]-a;var d=this._renderBoundaries[3]-b;var e=this._width;var f=this._height;var g=this._opacity;var h=this._maxOpacity;var i=this._minOpacity;var j=this._useGradientOpacity;if(a<0){a=0}if(b<0){b=0}if(a+c>e){c=e-a}if(b+d>f){d=f-b}var k=this.shadowCtx.getImageData(a,b,c,d);var l=k.data;var m=l.length;var n=this._palette;for(var o=3;o<m;o+=4){var p=l[o];var q=p*4;if(!q){continue}var r;if(g>0){r=g}else{if(p<h){if(p<i){r=i}else{r=p}}else{r=h}}l[o-3]=n[q];l[o-2]=n[q+1];l[o-1]=n[q+2];l[o]=j?n[q+3]:r}k.data=l;this.ctx.putImageData(k,a,b);this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(a){var b;var c=this.shadowCtx;var d=c.getImageData(a.x,a.y,1,1);var e=d.data[3];var f=this._max;var g=this._min;b=Math.abs(f-g)*(e/255)>>0;return b},getDataURL:function(){return this.canvas.toDataURL()}};return d}();var d=function j(){var b=false;if(a["defaultRenderer"]==="canvas2d"){b=c}return b}();var e={merge:function(){var a={};var b=arguments.length;for(var c=0;c<b;c++){var d=arguments[c];for(var e in d){a[e]=d[e]}}return a}};var f=function k(){var c=function h(){function a(){this.cStore={}}a.prototype={on:function(a,b,c){var d=this.cStore;if(!d[a]){d[a]=[]}d[a].push(function(a){return b.call(c,a)})},emit:function(a,b){var c=this.cStore;if(c[a]){var d=c[a].length;for(var e=0;e<d;e++){var f=c[a][e];f(b)}}}};return a}();var f=function(a){var b=a._renderer;var c=a._coordinator;var d=a._store;c.on("renderpartial",b.renderPartial,b);c.on("renderall",b.renderAll,b);c.on("extremachange",function(b){a._config.onExtremaChange&&a._config.onExtremaChange({min:b.min,max:b.max,gradient:a._config["gradient"]||a._config["defaultGradient"]})});d.setCoordinator(c)};function g(){var g=this._config=e.merge(a,arguments[0]||{});this._coordinator=new c;if(g["plugin"]){var h=g["plugin"];if(!a.plugins[h]){throw new Error("Plugin '"+h+"' not found. Maybe it was not registered.")}else{var i=a.plugins[h];this._renderer=new i.renderer(g);this._store=new i.store(g)}}else{this._renderer=new d(g);this._store=new b(g)}f(this)}g.prototype={addData:function(){this._store.addData.apply(this._store,arguments);return this},removeData:function(){this._store.removeData&&this._store.removeData.apply(this._store,arguments);return this},setData:function(){this._store.setData.apply(this._store,arguments);return this},setDataMax:function(){this._store.setDataMax.apply(this._store,arguments);return this},setDataMin:function(){this._store.setDataMin.apply(this._store,arguments);return this},configure:function(a){this._config=e.merge(this._config,a);this._renderer.updateConfig(this._config);this._coordinator.emit("renderall",this._store._getInternalData());return this},repaint:function(){this._coordinator.emit("renderall",this._store._getInternalData());return this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(a){if(this._store.getValueAt){return this._store.getValueAt(a)}else if(this._renderer.getValueAt){return this._renderer.getValueAt(a)}else{return null}}};return g}();var g={create:function(a){return new f(a)},register:function(b,c){a.plugins[b]=c}};return g});
"use strict";var tvurl="http://pefl.ru/tv/#/j=1099079&z=c3121c566116e3f04f0fba27f99d502c",MAX_VALUE=60,MAX_OPACITY=.7,MIN_OPACITY=.05,POINT_RADIUS=35,MAX_PLAYERS=18,GK_VALUE=.2,BALL_RADIUS_KEFF=.67,BALL_MAX_KEFF=.33,BALL_TACTICS_RADIUS_KEFF=1.1,BALL_TACTICS_MAX_KEFF=.35,TEAM_RADIUS_KEFF=.65,TEAM_MAX_KEFF=1.1,HOME=1,AWAY=2,SUB_OUT=1,SUB_IN=2,MIN_MINUTES_FOR_SHOW_TACTIC=3,shotsCoords={x1:39,y1:38,x2:712,y2:458},jsonCoords={x1:0,y1:0,x2:720,y2:450},hmCoords={x1:18.98,y1:19,x2:346.56,y2:229.5},FIELD_LONGTITUDE=105,MILEAGE_KEFF=FIELD_LONGTITUDE/(hmCoords.x2-hmCoords.x1);
"use strict";var ballPoints=[],minutesStarts=[0],strangePoints={home:[],away:[]},homeTacticChanges=[0],awayTacticChanges=[0],homeTacticPoints=[],awayTacticPoints=[],shots={home:[],away:[]},sumInterval=0;homeTacticPoints.push({start:0,end:1,period:0,startPoint:0,endPoint:1,team:[],ball:[],averages:[]}),awayTacticPoints.push({start:0,end:1,period:0,startPoint:0,endPoint:1,team:[],ball:[],averages:[]});var init_HomeTacticPoints=[];init_HomeTacticPoints.push({start:0,end:1,period:0,team:[],ball:[],averages:[]});for(var homePoints=[],awayPoints=[],homeAvgPoints=[],awayAvgPoints=[],homeMileage=[],awayMileage=[],homePointsFull=[],awayPointsFull=[],i=0;i<=MAX_PLAYERS;i++)homePoints.push([]),awayPoints.push([]),homeMileage.push(0),awayMileage.push(0),homeAvgPoints.push({x:0,y:0}),awayAvgPoints.push({x:0,y:0}),homeTacticPoints[0].averages.push([{x:0,y:0}]),awayTacticPoints[0].averages.push([{x:0,y:0}]),init_HomeTacticPoints[0].averages.push([{x:0,y:0}]),homePointsFull.push([]),awayPointsFull.push([]);var secondTime=!1,penalties=!1;
"use strict";var JSON_URL_START="http://pefl.ru/jsonreport.php";function formJsonUrl(t){var e=window.location.href.match(/j\=\d+\&z\=.+/i)?window.location.href:t,n=e.indexOf("&z="),r=e.indexOf("j=");return JSON_URL_START+"?j=".concat(e.substring(2+r,n),"&z=").concat(e.substring(3+n))}function limitPoint(t){var e,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:hmCoords,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:jsonCoords,u=t.x,a=t.y;return r?(e=Math.round(i.x2-(u-o.x1)*(i.x2-i.x1)/(o.x2-o.x1)),n=Math.round(i.y2-(a-o.y1)*(i.y2-i.y1)/(o.y2-o.y1))):(e=Math.round(i.x1+(u-o.x1)*(i.x2-i.x1)/(o.x2-o.x1)),n=Math.round(i.y1+(a-o.y1)*(i.y2-i.y1)/(o.y2-o.y1))),{x:e,y:n,value:t.value}}function getSegmentLength(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function getSegmentAngle(t,e){var n=e.x-t.x,r=e.y-t.y;return(n<0?r<0?-180:180:0)+180*Math.atan(r/n)/Math.PI}function getMileage(t,e){return MILEAGE_KEFF*getSegmentLength(t,e)}function leaveValuablePoints(t){return t.filter((function(t){return!t}))}function getPointsSet(t,e,n){return t.slice(e,n)}function clearPoint(t){return t.filter((function(t){return null!=t}))}function getSubArrow(t){var e=(t||SUB_OUT)==SUB_OUT?"http://pefl.ru/system/img/gm/out.gif":"http://pefl.ru/system/img/gm/in.gif",n=document.createElement("img");return n.src=e,n}function createEye(t){var e=document.createElement("img");e.src="http://pefl.ru/images/eye.png",e.alt="";var n=document.createElement("div");return n.className="tooltiptext",n.innerText=t,e.appendChild(n),e}
"use strict";function createShotLine(t,e,o){var n=document.createElement("div");return n.classList.add("shotline"),n.style.top=t.startpoint.y-1+"px",n.style.left=t.startpoint.x+"px",n.style.width=getSegmentLength(t.startpoint,t.endpoint)+"px",n.style.transform="rotate("+getSegmentAngle(t.startpoint,t.endpoint)+"deg)",n.style.borderTopColor=o,n}function createShotStart(t,e,o){var n=document.createElement("div");n.classList.add("shotstart"),n.style.borderColor=o,n.style.backgroundColor=o,n.style.top=t.startpoint.y-5+"px",n.style.left=t.startpoint.x-5+"px";var r="G"==t.type?"Гол":"V"==t.type?"Удар в створ":"Block"==t.type?"Блок":"B"==t.type?"Каркас ворот":"Мимо";return n.addEventListener("mouseenter",(function(o){var n=document.querySelector("#oneShotLegend"),a=" Минута "+t.minute+", "+r+",\n\r "+t.player+"."+e.playerName;n.textContent=a,n.style.display="inline-block"})),n.addEventListener("mouseleave",(function(t){document.querySelector("#oneShotLegend").style.display="none"})),n}function createShotEnd(t,e,o){var n=document.createElement("div");return n.classList.add("shotend"),n.style.borderColor=o,n.style.backgroundColor=o,n.style.top=t.endpoint.y-2+"px",n.style.left=t.endpoint.x-2+"px",n}function createShot(t,e){var o="G"==t.type?"red":"V"==t.type?"yellow":"Block"==t.type?"black":"blue",n=document.createElement("div");n.classList.add("shot");var r=e.team+"Shot";return n.classList.add(r),n.setAttribute("player",t.player),n.setAttribute("shotType",t.type),n.appendChild(createShotLine(t,e,o)),n.appendChild(createShotEnd(t,e,o)),n.appendChild(createShotStart(t,e,o)),n}function drawTeamShots(t,e,o,n){t.forEach((function(t,n){var r={playerName:e[t.player-1].name,team:o};document.querySelector("#chalkboard").appendChild(createShot(t,r))}))}function countShot(t,e){if("U"==t){if(!e.miss)return void(e.miss=1);e.miss++}if("G"==t){if(!e.goals)return void(e.goals=1);e.goals++}if("B"==t){if(!e.bar)return void(e.bar=1);e.bar++}if("Block"==t){if(!e.block)return void(e.block=1);e.block++}if("V"==t){if(!e.stvor)return void(e.stvor=1);e.stvor++}}function formShotsString(t){var e=t.goals?parseInt(t.goals):0,o=e+(t.stvor?parseInt(t.stvor):0),n=o+(t.miss?parseInt(t.miss):0),r="|"+e,a=t.bar?"|"+parseInt(t.bar):" ",l=t.block?"|"+parseInt(t.block):" ";return n+a+l==0?" ":0==n?"        "+l+a:(n>9?n:" "+n)+"|"+o+r+" "+l+a}function displayAllShots(t,e){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n="."+e+"Shot";document.querySelectorAll(n).forEach((function(n){var r=document.querySelector("#"+e+"PlayerList_"+n.getAttribute("player")+" input"),a=!!r&&r.checked;n.style.display=t?"block":a&&!o?"block":"none"}))}function changeCheckboxCount(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"home",o=document.querySelectorAll(".shots-container-wrapper")[0],n=parseInt("home"==e?o.getAttribute("data-homes"):o.getAttribute("data-aways"));return-1==t?n--:n++,n<0&&(n=0),"home"==e?o.setAttribute("data-homes",n):o.setAttribute("data-aways",n),n}function createShotCheckbox(t){var e=document.createElement("input");return e.type="checkbox",e.checked=!1,e.style.cursor="pointer",e.addEventListener("click",(function(e){this.checked?(changeCheckboxCount(1,t.team),displayAllShots(!1,t.team,!1)):0==changeCheckboxCount(-1,t.team)?displayAllShots(!0,t.team):displayAllShots(!1,t.team,!1)})),e}function changeVisibilityByType(t){t.preventDefault();var e=".shot[shottype="+this.getAttribute("data-type")+"]",o="bold"==this.style.fontWeight;document.querySelectorAll(e).forEach((function(t){t.style.display=o?"none":"block"})),this.style.fontWeight=o?"normal":"bold"}var fGoals=document.getElementById("filterGoals");fGoals.addEventListener("click",changeVisibilityByType.bind(fGoals));var fStvor=document.getElementById("filterStvor");fStvor.addEventListener("click",changeVisibilityByType.bind(fStvor));var fMiss=document.getElementById("filterMiss");fMiss.addEventListener("click",changeVisibilityByType.bind(fMiss));var fBars=document.getElementById("filterBars");fBars.addEventListener("click",changeVisibilityByType.bind(fBars));var fBlocks=document.getElementById("filterBlocks");function showAllShots(){displayAllShots(!0,"home"),displayAllShots(!0,"away"),document.querySelectorAll(".squadAndShots-containers-wrapper input[type=checkbox]").forEach((function(t){t.checked=!1}))}fBlocks.addEventListener("click",changeVisibilityByType.bind(fBlocks)),document.getElementsByClassName("shots-container")[0].addEventListener("click",(function(t){showAllShots()})),document.getElementById("filter-show-all").addEventListener("click",(function(t){t.preventDefault(),showAllShots()}));
"use strict";function createHeatMap(e,a,t){}var startTime=Date.now();window.onload=function(){var e=new XMLHttpRequest;function a(e){return window.location.origin+window.location.pathname+"?"+e.replace("http://pefl.ru/tv/#/","")}e.overrideMimeType("application/json"),e.onreadystatechange=function(){if(this.readyState==this.OPENED&&e.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),4==this.readyState)if(200==this.status){var a=function(e){return h337.create({container:document.querySelector(e),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS*TEAM_RADIUS_KEFF})},t=function(e,a,t){var o=e||"home",n=a||1,i=t||homeTacticPoints,r=o+"AvgPoints"+n,s="both"+o+"AvgPoints"+n,c=document.getElementById(r).style,l=document.getElementById(s).style;if(c.display="none"==c.display?"inherit":"none",l.display="none"==l.display?"inherit":"none",i.length>1)for(var m=1;m<i.length;m++)if(!(i[m].period<MIN_MINUTES_FOR_SHOW_TACTIC)){var d=o+"AvgPoints_"+m+"_"+n;document.getElementById(d).style.display="none"==document.getElementById(d).style.display?"inherit":"none"}},o=this.responseText.match(/\d+:\d+/g),n=o?o.pop():["0:0"],i=JSON.parse(this.responseText);X=document.getElementById("player_default_away").style,Y=document.getElementById("player_default_away").style,X.backgroundColor=i.away.team.back,X.borderColor=i.away.team.color,X.color=i.away.team.color,Y.color=i.home.team.color,Y.borderColor=i.home.team.color,Y.backgroundColor=i.home.team.back;var r=i.game;r.shift(),r.pop();var s="0:0";try{r.forEach((function(e,a,t){if(e.interval&&(sumInterval+=parseInt(e.interval)),minutesStarts[e.minute]||(minutesStarts[e.minute]=homePoints[1].length),e.S&&(1==e.S.team?(i.home.players[e.S.in-1].sub=SUB_IN,i.home.players[e.S.out-1].sub=SUB_OUT):(i.away.players[e.S.in-1].sub=SUB_IN,i.away.players[e.S.out-1].sub=SUB_OUT)),e.messages[0]&&(e.messages.forEach((function(e){e.mes.indexOf(" СЧЕТ ")>-1&&(s=e.mes.replace(" СЧЕТ ",""))})),"Серия пенальти!..."==e.messages[0].mes||"Матч переходит к послематчевым одиннадцатиметровым!..."==e.messages[0].mes||"Назначаются послематчевые пенальти!..."==e.messages[0].mes))throw penalties=!0,"Серия пенальти!...";if(e.ZT)if(1==e.ZT.team){homeTacticPoints[0].end=e.minute,homeTacticPoints[0].period=e.minute-homeTacticPoints[0].start,homeTacticPoints.push(homeTacticPoints[0]),homeTacticPoints[0]={start:e.minute,end:125,period:125-e.minute,team:[],ball:[],averages:[]};for(var o=0;o<=MAX_PLAYERS;o++)homeTacticPoints[0].averages.push([{x:0,y:0}]);homeTacticChanges.push(homePoints[0].length)}else{awayTacticPoints[0].end=e.minute,awayTacticPoints[0].period=e.minute-awayTacticPoints[0].start,awayTacticPoints.push(awayTacticPoints[0]),awayTacticPoints[0]={start:e.minute,end:125,period:125-e.minute,team:[],ball:[],averages:[]},awayTacticChanges.push(awayPoints[0].length);for(var n=0;n<=MAX_PLAYERS;n++)awayTacticPoints[0].averages.push([{x:0,y:0}])}var r;try{if(e.U&&!penalties){var c=e.coordinates.ball,l={x:c.w,y:c.h,value:1},m=e.G?"G":e.V?"V":e.B?"B":e.U.team>2?"Block":"U",d=t[a-1].messages.length>0&&t[a-1].coordinates?t[a-1].coordinates.ball:t[a-2].messages.length>0&&t[a-2].coordinates?t[a-2].coordinates.ball:t[a-3].messages.length>0&&t[a-3].coordinates?t[a-3].coordinates.ball:t[a-4].coordinates.ball,h={x:d.w,y:d.h,value:1},y={endpoint:limitPoint(l,secondTime,shotsCoords,jsonCoords),startpoint:limitPoint(h,secondTime,shotsCoords,jsonCoords),episode:a,type:m,minute:e.minute,player:e.U.player};1==e.U.team||3==e.U.team?shots.home.push(y):shots.away.push(y)}if(e.G&&!e.U){var p=e.coordinates.ball;console.log(e.minute,e.U,p);var u,v={x:p.w,y:p.h,value:1},T=limitPoint(v,secondTime,shotsCoords,jsonCoords);(u=1==e.G.team||3==e.G.team?shots.home[shots.home.length-1]:shots.away[shots.home.length-1]).type="G",u.endpoint=T,u.player=e.G.player}}catch(o){console.log("Что то не так с обсчетом удара",e.minute,e.n,o),console.log(e,t[a-1],t[a-2])}function P(e,a){for(var t=1;t<=MAX_PLAYERS;t++)e[t].push(a[t])}if(e.M&&(secondTime=!secondTime),e.coordinates){for(var w=e.coordinates.ball,g={x:w.w,y:w.h,value:1},_=e.coordinates.home,A=e.coordinates.away,S=[],C=[],f=0;f<=MAX_PLAYERS;f++)S.push(null),C.push(null);_.forEach((function(e){if(r=1==e.n?{x:e.w,y:e.h,value:GK_VALUE}:{x:e.w,y:e.h,value:1},e.n<=MAX_PLAYERS){var a=limitPoint(r,secondTime);if(homePoints[e.n].push(a),homePoints[0].push(a),homeTacticPoints[0].team.push(a),homeTacticPoints[0].averages[e.n].push(a),homePoints[e.n].length>1){var t=homePoints[e.n].length-1;homeMileage[e.n]+=getMileage(homePoints[e.n][t],homePoints[e.n][t-1])}S[e.n]=a}else strangePoints.home.push(e)})),A.forEach((function(e){if(r=1==e.n?{x:e.w,y:e.h,value:GK_VALUE}:{x:e.w,y:e.h,value:1},e.n<=MAX_PLAYERS){var a=limitPoint(r,!secondTime);if(awayPoints[e.n].push(a),awayPoints[0].push(a),awayTacticPoints[0].team.push(a),awayTacticPoints[0].averages[e.n].push(a),awayPoints[e.n].length>1){var t=awayPoints[e.n].length-1;awayMileage[e.n]+=getMileage(awayPoints[e.n][t],awayPoints[e.n][t-1])}C[e.n]=a}else strangePoints.away.push(e)}));var x=limitPoint(g,secondTime);ballPoints.push(x),homeTacticPoints[0].ball.push(x),awayTacticPoints[0].ball.push(x),P(homePointsFull,S),P(awayPointsFull,C)}}))}catch(e){console.log("game.forEach ",e)}homeTacticPoints.push(homeTacticPoints[0]),awayTacticPoints.push(awayTacticPoints[0]);var c=s+(n==s?"":"(".concat(function(e,a){var t=e.split(":"),o=a.split(":");return"".concat(o[0]-t[0],":").concat(o[1]-t[1])}(s,n),")")),l=i.date+". "+(i.stadium.city?i.stadium.city+". ":"")+i.stadium.name+". "+i.home.team.name+" - "+i.away.team.name+" "+c;document.querySelector("#game-info").textContent=l,shots.home.forEach((function(e){countShot(e.type,i.home.players[e.player-1])})),shots.away.forEach((function(e){countShot(e.type,i.away.players[e.player-1])}));var m=h337.create({container:document.querySelector("#heatmap-home"),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS*TEAM_RADIUS_KEFF}),d=h337.create({container:document.querySelector("#heatmap-away"),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS*TEAM_RADIUS_KEFF}),h=h337.create({container:document.querySelector("#heatmap-ball"),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS*BALL_RADIUS_KEFF}),y=a("#heatmap-avgHome"),p=a("#heatmap-avgAway"),u=a("#chalkboard"),v=a("#heatmap-avgBoth"),T=MAX_VALUE,P={max:T*TEAM_MAX_KEFF,data:homePoints[0]},w={max:T*TEAM_MAX_KEFF,data:[{x:19,y:19,value:1,radius:1},{x:346.56,y:229.5,value:200,radius:1},{x:19,y:229.5,value:1,radius:1},{x:346.56,y:19,value:1,radius:1}]};m.setData(P),d.setData({max:T*TEAM_MAX_KEFF,data:awayPoints[0]}),h.setData({max:T*BALL_MAX_KEFF,data:ballPoints}),y.setData(w),p.setData(w),u.setData(w),v.setData(w);var g=document.querySelector("#game-info").cloneNode(!0);if(g.id="homeTacticsInfo",g.textContent="Смены тактик "+i.home.team.name,document.body.appendChild(g),homeTacticPoints.length>1)for(var _=1;_<homeTacticPoints.length;_++)if(!(homeTacticPoints[_].period<MIN_MINUTES_FOR_SHOW_TACTIC)){homeTacticPoints[_].averages.forEach((function(e,a){var t=e.length;0===a||t<2||e.forEach((function(a,o,n){e[0].x+=a.x/t,e[0].y+=a.y/t}))}));var A=document.getElementsByClassName("heatmap2-containers-wrapper")[0].cloneNode(!0),S="#heatmap-tactichome"+_,C="#heatmap-ballhome"+_,f=(homeTacticPoints[_].start>0?"от "+homeTacticPoints[_].start:"")+" "+(homeTacticPoints[_].end<125?"до "+homeTacticPoints[_].end:"")+".  "+i.home.team.name;A.querySelector("#heatmap-home").id="heatmap-tactichome"+_,A.querySelector(S+" > div").textContent="Игроки "+f,A.querySelector("#heatmap-away").id="heatmap-ballhome"+_,A.querySelector(C+" > div").textContent="Мяч "+f,document.body.appendChild(A);var x=document.getElementsByClassName("heatmap-container-wrapper-right")[0].cloneNode(!0);x.className="thirdHeatmap",A.className="heatmap3-containers-wrapper",x.querySelector(".heatmap-container").id="avgPositionsHome"+_,x.querySelector(".heatmap-container > div").textContent="Ср.поз."+f,A.appendChild(x);for(var E=1;E<=MAX_PLAYERS;E++){var I=document.querySelector("#player_default_home").cloneNode(!0);I.id="homeAvgPoints_"+_+"_"+E,I.style.display=E<12?"inherit":"none",I.style.left=homeTacticPoints[_].averages[E][0].x-5+"px",I.style.top=homeTacticPoints[_].averages[E][0].y-5+"px",I.querySelector(".player_number").textContent=i.home.players[E-1].number,I.querySelector(".tooltiptext").textContent=i.home.players[E-1].name+"    "+i.home.players[E-1].number,document.querySelector("#avgPositionsHome"+_).appendChild(I)}a("#avgPositionsHome"+_).setData(w),h337.create({container:document.querySelector(S),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS}).setData({max:T,data:homeTacticPoints[_].team}),h337.create({container:document.querySelector(C),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS*BALL_RADIUS_KEFF*BALL_TACTICS_RADIUS_KEFF}).setData({max:T*BALL_MAX_KEFF*BALL_TACTICS_MAX_KEFF,data:homeTacticPoints[_].ball})}var b=document.querySelector("#game-info").cloneNode(!0);if(b.id="awayTacticsInfo",b.textContent="Смены тактик "+i.away.team.name,document.body.appendChild(b),awayTacticPoints.length>1)for(var N=1;N<awayTacticPoints.length;N++)if(!(awayTacticPoints[N].period<MIN_MINUTES_FOR_SHOW_TACTIC)){awayTacticPoints[N].averages.forEach((function(e,a){var t=e.length;0===a||t<2||e.forEach((function(a,o,n){e[0].x+=a.x/t,e[0].y+=a.y/t}))}));var q=document.getElementsByClassName("heatmap2-containers-wrapper")[0].cloneNode(!0),M="#heatmap-tacticaway"+N,O="#heatmap-ballaway"+N,F=(awayTacticPoints[N].start>0?"от "+awayTacticPoints[N].start:"")+" "+(awayTacticPoints[N].end<125?"до "+awayTacticPoints[N].end:"")+".  "+i.away.team.name;q.querySelector("#heatmap-home").id="heatmap-tacticaway"+N,q.querySelector(M+" > div").textContent="Игроки "+F,q.querySelector("#heatmap-away").id="heatmap-ballaway"+N,q.querySelector(O+" > div").textContent="Мяч "+F,document.body.appendChild(q);var L=document.getElementsByClassName("heatmap-container-wrapper-right")[0].cloneNode(!0);L.className="thirdHeatmap",q.className="heatmap3-containers-wrapper",L.querySelector(".heatmap-container").id="avgPositionsAway"+N,L.querySelector(".heatmap-container > div").textContent="Ср.поз."+F,q.appendChild(L);for(var U=1;U<=MAX_PLAYERS;U++){var D=document.querySelector("#player_default_away").cloneNode(!0);D.id="awayAvgPoints_"+N+"_"+U,D.style.display=U<12?"inherit":"none",D.style.left=awayTacticPoints[N].averages[U][0].x-5+"px",D.style.top=awayTacticPoints[N].averages[U][0].y-5+"px",D.querySelector(".player_number").textContent=i.away.players[U-1].number,D.querySelector(".tooltiptext").textContent=i.away.players[U-1].name+"    "+i.away.players[U-1].number,document.querySelector("#avgPositionsAway"+N).appendChild(D)}h337.create({container:document.querySelector(M),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS}).setData({max:T,data:awayTacticPoints[N].team}),h337.create({container:document.querySelector(O),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS*BALL_RADIUS_KEFF*BALL_TACTICS_RADIUS_KEFF}).setData({max:T*BALL_MAX_KEFF*BALL_TACTICS_MAX_KEFF,data:awayTacticPoints[N].ball})}setTimeout((function(){var e=document.querySelector("#game-info").cloneNode(!0);e.id="playersHeatmapsInfo",e.textContent="Тепловые карты игроков ",document.body.appendChild(e);for(var a=1;a<=MAX_PLAYERS;a++){var t=document.getElementsByClassName("heatmap2-containers-wrapper")[0].cloneNode(!0),o="#heatmap-home"+a,n="#heatmap-away"+a;t.querySelector("#heatmap-home").id="heatmap-home"+a,t.querySelector(o+" > div").textContent=i.home.players[a-1].number+". "+i.home.players[a-1].name,t.querySelector("#heatmap-away").id="heatmap-away"+a,t.querySelector(n+" > div").textContent=i.away.players[a-1].number+". "+i.away.players[a-1].name,document.body.appendChild(t),h337.create({container:document.querySelector(o),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS}).setData({max:T*TEAM_MAX_KEFF,data:homePoints[a]}),h337.create({container:document.querySelector(n),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS}).setData({max:T,data:awayPoints[a]})}}),10),document.querySelector("#heatmap-home .overlay").textContent=i.home.team.name,document.querySelector("#heatmap-away .overlay").textContent=i.away.team.name,document.querySelector("#heatmap-avgHome .overlay").textContent="Средние позиции "+i.home.team.name,document.querySelector("#heatmap-avgAway .overlay").textContent="Средние позиции "+i.away.team.name,homeTacticChanges.push(homePoints[0].length-1),awayTacticChanges.push(awayPoints[0].length-1),homePoints.forEach((function(e,a){var t=e.length;0===a||t<1||e.forEach((function(e,o){homeAvgPoints[a].x+=e.x/t,homeAvgPoints[a].y+=e.y/t}))})),awayPoints.forEach((function(e,a){var t=e.length;0===a||t<1||e.forEach((function(e,o){awayAvgPoints[a].x+=e.x/t,awayAvgPoints[a].y+=e.y/t}))})),setTimeout((function(){for(var e=1;e<=MAX_PLAYERS;e++){var a=document.querySelector("#player_default_home").cloneNode(!0),o=document.querySelector("#player_default_away").cloneNode(!0);o.id="awayAvgPoints"+e,o.plId="aw"+e,o.style.display=e<12?"inherit":"none",o.style.left=awayAvgPoints[e].x-5+"px",o.style.top=awayAvgPoints[e].y-5+"px";var n="away-player-list_"+e,r=document.createElement("div");r.className="playerRow",r.id=n;var s=document.createElement("div");s.innerText=i.away.players[e-1].number+". ",s.className="player-list-num";var c=document.createElement("div");c.className="player-list-name";var l=document.createElement("a");l.style.fontWeight=e<12?"bold":"normal",l.id=n+"_name",l.innerText=i.away.players[e-1].name,l.href="#",l.addEventListener("click",(function(e){e.preventDefault(),this.style.fontWeight="bold"==this.style.fontWeight?"normal":"bold",t("away",this.id.replace("away-player-list_","").replace("_name",""),awayTacticPoints)})),i.away.players[e-1].sub&&l.appendChild(getSubArrow(i.away.players[e-1].sub)),c.appendChild(l),r.appendChild(s),r.appendChild(c);var m=document.createElement("div");m.className="player-list-eye",m.innerText=" ",r.appendChild(m);var d=document.createElement("div");d.className="player-list-shots";var h=formShotsString(i.away.players[e-1]);d.innerText=h;var y=document.createElement("div");if(y.className="playerShotCheckbox"," "==h)y.innerText=" ";else{y.appendChild(createShotCheckbox({player:e,team:"away"}));var p=document.createElement("div");p.className="tooltiptext",p.innerText="Удары|В створ|Голы   |Блокированные|Каркас",d.appendChild(p)}r.appendChild(y),r.appendChild(d);var u=document.createElement("div");u.className="player-list-mileage",u.innerText=Number(awayMileage[e]/1e3).toFixed(2)+" км",r.appendChild(u),document.querySelector("#squadAway").appendChild(r),o.querySelector(".player_number").textContent=i.away.players[e-1].number,o.querySelector(".tooltiptext").textContent=i.away.players[e-1].name+"    "+i.away.players[e-1].number,document.getElementById("heatmap-avgAway").appendChild(o);var v=o.cloneNode(!0);v.id="both"+v.id,document.getElementById("heatmap-avgBoth").appendChild(v);var T=o.cloneNode(!0);T.id=T.id+"_individual",document.querySelector("#heatmap-away"+e).appendChild(T),a.id="homeAvgPoints"+e,a.plId="hm"+e,a.style.display=e<12?"inherit":"none",a.style.left=homeAvgPoints[e].x-5+"px",a.style.top=homeAvgPoints[e].y-5+"px";var P="home-player-list_"+e,w=document.createElement("div");w.id=P,w.className="playerRow";var g=document.createElement("div");g.innerText=i.home.players[e-1].number+". ",g.className="player-list-num",w.appendChild(g);var _=document.createElement("div");_.className="player-list-name";var A=document.createElement("a");A.style.fontWeight=e<12?"bold":"normal",A.id=P+"_name",A.innerText=i.home.players[e-1].name,A.href="#",A.addEventListener("click",(function(e){e.preventDefault(),this.style.fontWeight="bold"==this.style.fontWeight?"normal":"bold",t("home",this.id.replace("home-player-list_","").replace("_name",""),homeTacticPoints)})),i.home.players[e-1].sub&&A.appendChild(getSubArrow(i.home.players[e-1].sub)),_.appendChild(A),w.appendChild(_);var S=document.createElement("div");S.className="player-list-eye",S.innerText=" ",w.appendChild(S);var C=document.createElement("div");C.className="player-list-shots";var f=formShotsString(i.home.players[e-1]);C.innerText=f;var x=document.createElement("div");if(x.className="playerShotCheckbox"," "==f)x.innerText=" ";else{x.appendChild(createShotCheckbox({player:e,team:"home"}));var E=document.createElement("div");E.className="tooltiptext",E.innerText="Удары|В створ|Голы   |Блокированные|Каркас",C.appendChild(E)}w.appendChild(x),w.appendChild(C);var I=document.createElement("div");I.className="player-list-mileage",I.innerText=Number(homeMileage[e]/1e3).toFixed(2)+" км",w.appendChild(I),document.querySelector("#squadHome").appendChild(w),a.querySelector(".player_number").textContent=i.home.players[e-1].number,a.querySelector(".tooltiptext").textContent=i.home.players[e-1].name+"    "+i.home.players[e-1].number,document.getElementById("heatmap-avgHome").appendChild(a);var b=a.cloneNode(!0);b.id="both"+b.id,document.getElementById("heatmap-avgBoth").appendChild(b);var N=a.cloneNode(!0);N.id=N.id+"_individual",document.querySelector("#heatmap-home"+e).appendChild(N)}}),200),setTimeout((function(){document.body.removeChild(document.querySelector(".loader-wrapper"))}),1e3);var B=document.querySelector("#chalkboard .heatmap-canvas");if(B.getContext){var R=B.getContext("2d");drawTeamShots(shots.away,i.away.players,"away",R),drawTeamShots(shots.home,i.home.players,"home",R)}}else alert("Вставьте верно ссылку на матч!");var X,Y},e.open("GET",formJsonUrl(tvurl),!0),e.send();var t=document.querySelector("#pasteButton"),o=document.querySelector("#tv-url-input");navigator.clipboard?t.addEventListener("click",(function(e){navigator.clipboard.readText().then((function(e){o.value=e})).catch((function(e){console.log("Работа с буфером сейчас не разрешена или не доступна в вашем браузере!")}))})):t.remove(),document.querySelector("#updateButton").addEventListener("click",(function(e){e.preventDefault(),o.value.match(/http\:\/\/pefl.ru\/tv\/\#\/j\=\d+\&z\=.+/i)?window.location.assign(a(o.value)):alert("Вставьте корректную ссылку на ТВ матча в поле ввода!")})),document.querySelector("#newWindow").addEventListener("click",(function(e){e.preventDefault(),o.value.match(/http\:\/\/pefl.ru\/tv\/\#\/j\=\d+\&z\=.+/i)?window.open(a(o.value),"_blank"):alert("Вставьте корректную ссылку на ТВ матча в поле ввода!")}))};
//# sourceMappingURL=hm.js.map
