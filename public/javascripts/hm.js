!function(e,t,a){"undefined"!=typeof module&&module.exports?module.exports=a():"function"==typeof define&&define.amd?define(a):t.h337=a()}(0,this,(function(){var e={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},t=function(){var t=function(e){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=e.xField||e.defaultXField,this._yField=e.yField||e.defaultYField,this._valueField=e.valueField||e.defaultValueField,e.radius&&(this._cfgRadius=e.radius)},a=e.defaultRadius;return t.prototype={_organiseData:function(e,t){var n=e[this._xField],o=e[this._yField],i=this._radi,s=this._data,r=this._max,l=this._min,c=e[this._valueField]||1,h=e.radius||this._cfgRadius||a;s[n]||(s[n]=[],i[n]=[]),s[n][o]?s[n][o]+=c:(s[n][o]=c,i[n][o]=h);var d=s[n][o];return d>r?(t?this.setDataMax(d):this._max=d,!1):d<l?(t?this.setDataMin(d):this._min=d,!1):{x:n,y:o,value:c,radius:h,min:l,max:r}},_unOrganizeData:function(){var e=[],t=this._data,a=this._radi;for(var n in t)for(var o in t[n])e.push({x:n,y:o,radius:a[n][o],value:t[n][o]});return{min:this._min,max:this._max,data:e}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var e=arguments[0],t=e.length;t--;)this.addData.call(this,e[t]);else{var a=this._organiseData(arguments[0],!0);a&&(0===this._data.length&&(this._min=this._max=a.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[a]}))}return this},setData:function(e){var t=e.data,a=t.length;this._data=[],this._radi=[];for(var n=0;n<a;n++)this._organiseData(t[n],!1);return this._max=e.max,this._min=e.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(e){return this._max=e,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(e){return this._min=e,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(e){this._coordinator=e},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},t}(),a=function(){var e=function(e){var t=e.gradient||e.defaultGradient,a=document.createElement("canvas"),n=a.getContext("2d");a.width=256,a.height=1;var o=n.createLinearGradient(0,0,256,1);for(var i in t)o.addColorStop(i,t[i]);return n.fillStyle=o,n.fillRect(0,0,256,1),n.getImageData(0,0,256,1).data},t=function(e,t){var a=document.createElement("canvas"),n=a.getContext("2d"),o=e,i=e;if(a.width=a.height=2*e,1==t)n.beginPath(),n.arc(o,i,e,0,2*Math.PI,!1),n.fillStyle="rgba(0,0,0,1)",n.fill();else{var s=n.createRadialGradient(o,i,e*t,o,i,e);s.addColorStop(0,"rgba(0,0,0,1)"),s.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=s,n.fillRect(0,0,2*e,2*e)}return a};function a(t){var a=t.container,n=this.shadowCanvas=document.createElement("canvas"),o=this.canvas=t.canvas||document.createElement("canvas"),i=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(t.container)||{});o.className="heatmap-canvas",this._width=o.width=n.width=t.width||+i.width.replace(/px/,""),this._height=o.height=n.height=t.height||+i.height.replace(/px/,""),this.shadowCtx=n.getContext("2d"),this.ctx=o.getContext("2d"),o.style.cssText=n.style.cssText="position:absolute;left:0;top:0;",a.style.position="relative",a.appendChild(o),this._palette=e(t),this._templates={},this._setStyles(t)}return a.prototype={renderPartial:function(e){e.data.length>0&&(this._drawAlpha(e),this._colorize())},renderAll:function(e){this._clear(),e.data.length>0&&(this._drawAlpha(function(e){for(var t=[],a=e.min,n=e.max,o=e.radi,i=(e=e.data,Object.keys(e)),s=i.length;s--;)for(var r=i[s],l=Object.keys(e[r]),c=l.length;c--;){var h=l[c],d=e[r][h],m=o[r][h];t.push({x:r,y:h,value:d,radius:m})}return{min:a,max:n,data:t}}(e)),this._colorize())},_updateGradient:function(t){this._palette=e(t)},updateConfig:function(e){e.gradient&&this._updateGradient(e),this._setStyles(e)},setDimensions:function(e,t){this._width=e,this._height=t,this.canvas.width=this.shadowCanvas.width=e,this.canvas.height=this.shadowCanvas.height=t},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(e){this._blur=0==e.blur?0:e.blur||e.defaultBlur,e.backgroundColor&&(this.canvas.style.backgroundColor=e.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=e.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=e.height||this._height,this._opacity=255*(e.opacity||0),this._maxOpacity=255*(e.maxOpacity||e.defaultMaxOpacity),this._minOpacity=255*(e.minOpacity||e.defaultMinOpacity),this._useGradientOpacity=!!e.useGradientOpacity},_drawAlpha:function(e){for(var a=this._min=e.min,n=this._max=e.max,o=(e=e.data||[]).length,i=1-this._blur;o--;){var s,r=e[o],l=r.x,c=r.y,h=r.radius,d=Math.min(r.value,n),m=l-h,u=c-h,p=this.shadowCtx;this._templates[h]?s=this._templates[h]:this._templates[h]=s=t(h,i);var y=(d-a)/(n-a);p.globalAlpha=y<.01?.01:y,p.drawImage(s,m,u),m<this._renderBoundaries[0]&&(this._renderBoundaries[0]=m),u<this._renderBoundaries[1]&&(this._renderBoundaries[1]=u),m+2*h>this._renderBoundaries[2]&&(this._renderBoundaries[2]=m+2*h),u+2*h>this._renderBoundaries[3]&&(this._renderBoundaries[3]=u+2*h)}},_colorize:function(){var e=this._renderBoundaries[0],t=this._renderBoundaries[1],a=this._renderBoundaries[2]-e,n=this._renderBoundaries[3]-t,o=this._width,i=this._height,s=this._opacity,r=this._maxOpacity,l=this._minOpacity,c=this._useGradientOpacity;e<0&&(e=0),t<0&&(t=0),e+a>o&&(a=o-e),t+n>i&&(n=i-t);for(var h=this.shadowCtx.getImageData(e,t,a,n),d=h.data,m=d.length,u=this._palette,p=3;p<m;p+=4){var y,g=d[p],f=4*g;if(f)y=s>0?s:g<r?g<l?l:g:r,d[p-3]=u[f],d[p-2]=u[f+1],d[p-1]=u[f+2],d[p]=c?u[f+3]:y}h.data=d,this.ctx.putImageData(h,e,t),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(e){var t=this.shadowCtx.getImageData(e.x,e.y,1,1).data[3],a=this._max,n=this._min;return Math.abs(a-n)*(t/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}},a}(),n=function(){var t=!1;return"canvas2d"===e.defaultRenderer&&(t=a),t}(),o={merge:function(){for(var e={},t=arguments.length,a=0;a<t;a++){var n=arguments[a];for(var o in n)e[o]=n[o]}return e}},i=function(){var a=function(){function e(){this.cStore={}}return e.prototype={on:function(e,t,a){var n=this.cStore;n[e]||(n[e]=[]),n[e].push((function(e){return t.call(a,e)}))},emit:function(e,t){var a=this.cStore;if(a[e])for(var n=a[e].length,o=0;o<n;o++){(0,a[e][o])(t)}}},e}(),i=function(e){var t=e._renderer,a=e._coordinator,n=e._store;a.on("renderpartial",t.renderPartial,t),a.on("renderall",t.renderAll,t),a.on("extremachange",(function(t){e._config.onExtremaChange&&e._config.onExtremaChange({min:t.min,max:t.max,gradient:e._config.gradient||e._config.defaultGradient})})),n.setCoordinator(a)};function s(){var s=this._config=o.merge(e,arguments[0]||{});if(this._coordinator=new a,s.plugin){var r=s.plugin;if(!e.plugins[r])throw new Error("Plugin '"+r+"' not found. Maybe it was not registered.");var l=e.plugins[r];this._renderer=new l.renderer(s),this._store=new l.store(s)}else this._renderer=new n(s),this._store=new t(s);i(this)}return s.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(e){return this._config=o.merge(this._config,e),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(e){return this._store.getValueAt?this._store.getValueAt(e):this._renderer.getValueAt?this._renderer.getValueAt(e):null}},s}();return{create:function(e){return new i(e)},register:function(t,a){e.plugins[t]=a}}}));const tvurl="http://pefl.ru/tv/#/j=1099079&z=c3121c566116e3f04f0fba27f99d502c",MAX_VALUE=60,MAX_OPACITY=.7,MIN_OPACITY=.05,POINT_RADIUS=35,MAX_PLAYERS=18,GK_VALUE=.2,BALL_RADIUS_KEFF=.67,BALL_MAX_KEFF=.33,BALL_TACTICS_RADIUS_KEFF=1.1,BALL_TACTICS_MAX_KEFF=.35,TEAM_RADIUS_KEFF=.65,TEAM_MAX_KEFF=1.1,HOME=1,AWAY=2,SUB_OUT=1,SUB_IN=2,MIN_MINUTES_FOR_SHOW_TACTIC=3,shotsCoords={x1:39,y1:38,x2:712,y2:458},jsonCoords={x1:0,y1:0,x2:720,y2:450},hmCoords={x1:18.98,y1:19,x2:346.56,y2:229.5},FIELD_LONGTITUDE=105,MILEAGE_KEFF=105/(hmCoords.x2-hmCoords.x1),ballPoints=[],minutesStarts=[0],strangePoints={home:[],away:[]},homeTacticChanges=[0],awayTacticChanges=[0],homeTacticPoints=[],awayTacticPoints=[],shots={home:[],away:[]};let sumInterval=0;homeTacticPoints.push({start:0,end:1,period:0,startPoint:0,endPoint:1,team:[],ball:[],averages:[]}),awayTacticPoints.push({start:0,end:1,period:0,startPoint:0,endPoint:1,team:[],ball:[],averages:[]});const init_HomeTacticPoints=[];init_HomeTacticPoints.push({start:0,end:1,period:0,team:[],ball:[],averages:[]});const homePoints=[],awayPoints=[],homeAvgPoints=[],awayAvgPoints=[],homeMileage=[],awayMileage=[],homePointsFull=[],awayPointsFull=[];for(let e=0;e<=MAX_PLAYERS;e++)homePoints.push([]),awayPoints.push([]),homeMileage.push(0),awayMileage.push(0),homeAvgPoints.push({x:0,y:0}),awayAvgPoints.push({x:0,y:0}),homeTacticPoints[0].averages.push([{x:0,y:0}]),awayTacticPoints[0].averages.push([{x:0,y:0}]),init_HomeTacticPoints[0].averages.push([{x:0,y:0}]),homePointsFull.push([]),awayPointsFull.push([]);let secondTime=!1;var penalties=!1;const JSON_URL_START="http://pefl.ru/jsonreport.php";function formJsonUrl(e){const t=window.location.href.match(/j\=\d+\&z\=.+/i)?window.location.href:e,a=t.indexOf("&z="),n=t.indexOf("j=");return JSON_URL_START+`?j=${t.substring(2+n,a)}&z=${t.substring(3+a)}`}function limitPoint(e,t=!1,a=hmCoords,n=jsonCoords){const o=e.x,i=e.y;let s,r;return t?(s=Math.round(a.x2-(o-n.x1)*(a.x2-a.x1)/(n.x2-n.x1)),r=Math.round(a.y2-(i-n.y1)*(a.y2-a.y1)/(n.y2-n.y1))):(s=Math.round(a.x1+(o-n.x1)*(a.x2-a.x1)/(n.x2-n.x1)),r=Math.round(a.y1+(i-n.y1)*(a.y2-a.y1)/(n.y2-n.y1))),{x:s,y:r,value:e.value}}function getSegmentLength(e,t){const a=t.x-e.x,n=t.y-e.y;return Math.sqrt(a*a+n*n)}function getSegmentAngle(e,t){const a=t.x-e.x,n=t.y-e.y;return(a<0?n<0?-180:180:0)+180*Math.atan(n/a)/Math.PI}function getMileage(e,t){return MILEAGE_KEFF*getSegmentLength(e,t)}function leaveValuablePoints(e){return e.filter(e=>!e)}function getPointsSet(e,t,a){return e.slice(t,a)}function clearPoint(e){return e.filter(e=>null!=e)}function getSubArrow(e){const t=(e||SUB_OUT)==SUB_OUT?"http://pefl.ru/system/img/gm/out.gif":"http://pefl.ru/system/img/gm/in.gif",a=document.createElement("img");return a.src=t,a}function createEye(e){const t=document.createElement("img");t.src="http://pefl.ru/images/eye.png",t.alt="";const a=document.createElement("div");return a.className="tooltiptext",a.innerText=e,t.appendChild(a),t}function createShotLine(e,t,a){const n=document.createElement("div");return n.classList.add("shotline"),n.style.top=e.startpoint.y-1+"px",n.style.left=e.startpoint.x+"px",n.style.width=getSegmentLength(e.startpoint,e.endpoint)+"px",n.style.transform="rotate("+getSegmentAngle(e.startpoint,e.endpoint)+"deg)",n.style.borderTopColor=a,n}function createShotStart(e,t,a){const n=document.createElement("div");n.classList.add("shotstart"),n.style.borderColor=a,n.style.backgroundColor=a,n.style.top=e.startpoint.y-5+"px",n.style.left=e.startpoint.x-5+"px";const o="G"==e.type?"Гол":"V"==e.type?"Удар в створ":"Block"==e.type?"Блок":"B"==e.type?"Каркас ворот":"Мимо";return n.addEventListener("mouseenter",(function(a){const n=document.querySelector("#oneShotLegend"),i=" Минута "+e.minute+", "+o+",\n\r "+e.player+"."+t.playerName;n.textContent=i,n.style.display="inline-block"})),n.addEventListener("mouseleave",(function(e){document.querySelector("#oneShotLegend").style.display="none"})),n}function createShotEnd(e,t,a){const n=document.createElement("div");return n.classList.add("shotend"),n.style.borderColor=a,n.style.backgroundColor=a,n.style.top=e.endpoint.y-2+"px",n.style.left=e.endpoint.x-2+"px",n}function createShot(e,t){const a="G"==e.type?"red":"V"==e.type?"yellow":"Block"==e.type?"black":"blue",n=document.createElement("div");n.classList.add("shot");const o=t.team+"Shot";return n.classList.add(o),n.setAttribute("player",e.player),n.setAttribute("shotType",e.type),n.appendChild(createShotLine(e,t,a)),n.appendChild(createShotEnd(e,t,a)),n.appendChild(createShotStart(e,t,a)),n}function drawTeamShots(e,t,a,n){e.forEach((e,n)=>{const o={playerName:t[e.player-1].name,team:a};document.querySelector("#chalkboard").appendChild(createShot(e,o))})}function countShot(e,t){if("U"==e){if(!t.miss)return void(t.miss=1);t.miss++}if("G"==e){if(!t.goals)return void(t.goals=1);t.goals++}if("B"==e){if(!t.bar)return void(t.bar=1);t.bar++}if("Block"==e){if(!t.block)return void(t.block=1);t.block++}if("V"==e){if(!t.stvor)return void(t.stvor=1);t.stvor++}}function formShotsString(e){const t=e.goals?parseInt(e.goals):0,a=t+(e.stvor?parseInt(e.stvor):0),n=a+(e.miss?parseInt(e.miss):0),o="|"+t,i=e.bar?"|"+parseInt(e.bar):" ",s=e.block?"|"+parseInt(e.block):" ";return n+i+s==0?" ":0==n?"        "+s+i:(n>9?n:" "+n)+"|"+a+o+" "+s+i}function displayAllShots(e,t,a=!0){const n="."+t+"Shot";document.querySelectorAll(n).forEach(n=>{const o=document.querySelector("#"+t+"PlayerList_"+n.getAttribute("player")+" input");let i=!!o&&o.checked;n.style.display=e?"block":i&&!a?"block":"none"})}function changeCheckboxCount(e=-1,t="home"){const a=document.querySelectorAll(".shots-container-wrapper")[0];let n=parseInt("home"==t?a.getAttribute("data-homes"):a.getAttribute("data-aways"));return-1==e?n--:n++,n<0&&(n=0),"home"==t?a.setAttribute("data-homes",n):a.setAttribute("data-aways",n),n}function createShotCheckbox(e){const t=document.createElement("input");return t.type="checkbox",t.checked=!1,t.style.cursor="pointer",t.addEventListener("click",(function(t){this.checked?(changeCheckboxCount(1,e.team),displayAllShots(!1,e.team,!1)):0==changeCheckboxCount(-1,e.team)?displayAllShots(!0,e.team):displayAllShots(!1,e.team,!1)})),t}function changeVisibilityByType(e){e.preventDefault();const t=".shot[shottype="+this.getAttribute("data-type")+"]",a="bold"==this.style.fontWeight;document.querySelectorAll(t).forEach(e=>{e.style.display=a?"none":"block"}),this.style.fontWeight=a?"normal":"bold"}const fGoals=document.getElementById("filterGoals");fGoals.addEventListener("click",changeVisibilityByType.bind(fGoals));const fStvor=document.getElementById("filterStvor");fStvor.addEventListener("click",changeVisibilityByType.bind(fStvor));const fMiss=document.getElementById("filterMiss");fMiss.addEventListener("click",changeVisibilityByType.bind(fMiss));const fBars=document.getElementById("filterBars");fBars.addEventListener("click",changeVisibilityByType.bind(fBars));const fBlocks=document.getElementById("filterBlocks");function showAllShots(){displayAllShots(!0,"home"),displayAllShots(!0,"away"),document.querySelectorAll(".squadAndShots-containers-wrapper input[type=checkbox]").forEach(e=>{e.checked=!1})}function createHeatMap(e,t,a){}fBlocks.addEventListener("click",changeVisibilityByType.bind(fBlocks)),document.getElementsByClassName("shots-container")[0].addEventListener("click",(function(e){showAllShots()})),document.getElementById("filter-show-all").addEventListener("click",(function(e){e.preventDefault(),showAllShots()}));let startTime=Date.now();window.onload=function(){var e=new XMLHttpRequest;function t(e){return window.location.origin+window.location.pathname+"?"+e.replace("http://pefl.ru/tv/#/","")}e.overrideMimeType("application/json"),e.onreadystatechange=function(){if(this.readyState==this.OPENED&&e.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),4==this.readyState)if(200==this.status){const e=this.responseText.match(/\d+:\d+/g),s=e?e.pop():["0:0"],r=JSON.parse(this.responseText);function t(){const e=document.getElementById("player_default_away").style,t=document.getElementById("player_default_away").style;e.backgroundColor=r.away.team.back,e.borderColor=r.away.team.color,e.color=r.away.team.color,t.color=r.home.team.color,t.borderColor=r.home.team.color,t.backgroundColor=r.home.team.back}t();const l=r.game;l.shift(),l.pop();let c="0:0";try{l.forEach((e,t,a)=>{if(e.interval&&(sumInterval+=parseInt(e.interval)),minutesStarts[e.minute]||(minutesStarts[e.minute]=homePoints[1].length),e.S&&(1==e.S.team?(r.home.players[e.S.in-1].sub=2,r.home.players[e.S.out-1].sub=SUB_OUT):(r.away.players[e.S.in-1].sub=2,r.away.players[e.S.out-1].sub=SUB_OUT)),e.messages[0]&&(e.messages.forEach(e=>{e.mes.indexOf(" СЧЕТ ")>-1&&(c=e.mes.replace(" СЧЕТ ",""))}),"Серия пенальти!..."==e.messages[0].mes||"Матч переходит к послематчевым одиннадцатиметровым!..."==e.messages[0].mes||"Назначаются послематчевые пенальти!..."==e.messages[0].mes))throw penalties=!0,"Серия пенальти!...";if(e.ZT)if(1==e.ZT.team){homeTacticPoints[0].end=e.minute,homeTacticPoints[0].period=e.minute-homeTacticPoints[0].start,homeTacticPoints.push(homeTacticPoints[0]),homeTacticPoints[0]={start:e.minute,end:125,period:125-e.minute,team:[],ball:[],averages:[]};for(let e=0;e<=MAX_PLAYERS;e++)homeTacticPoints[0].averages.push([{x:0,y:0}]);homeTacticChanges.push(homePoints[0].length)}else{awayTacticPoints[0].end=e.minute,awayTacticPoints[0].period=e.minute-awayTacticPoints[0].start,awayTacticPoints.push(awayTacticPoints[0]),awayTacticPoints[0]={start:e.minute,end:125,period:125-e.minute,team:[],ball:[],averages:[]},awayTacticChanges.push(awayPoints[0].length);for(let e=0;e<=MAX_PLAYERS;e++)awayTacticPoints[0].averages.push([{x:0,y:0}])}let n;try{if(e.U&&!penalties){const n=e.coordinates.ball,o={x:n.w,y:n.h,value:1},i=e.G?"G":e.V?"V":e.B?"B":e.U.team>2?"Block":"U",s=a[t-1].messages.length>0&&a[t-1].coordinates?a[t-1].coordinates.ball:a[t-2].messages.length>0&&a[t-2].coordinates?a[t-2].coordinates.ball:a[t-3].messages.length>0&&a[t-3].coordinates?a[t-3].coordinates.ball:a[t-4].coordinates.ball,r={x:s.w,y:s.h,value:1},l={endpoint:limitPoint(o,secondTime,shotsCoords,jsonCoords),startpoint:limitPoint(r,secondTime,shotsCoords,jsonCoords),episode:t,type:i,minute:e.minute,player:e.U.player};1==e.U.team||3==e.U.team?shots.home.push(l):shots.away.push(l)}if(e.G&&!e.U){const t=e.coordinates.ball;console.log(e.minute,e.U,t);const a=limitPoint({x:t.w,y:t.h,value:1},secondTime,shotsCoords,jsonCoords);let n;(n=1==e.G.team||3==e.G.team?shots.home[shots.home.length-1]:shots.away[shots.home.length-1]).type="G",n.endpoint=a,n.player=e.G.player}}catch(n){console.log("Что то не так с обсчетом удара",e.minute,e.n,n),console.log(e,a[t-1],a[t-2])}function o(e,t){for(let a=1;a<=MAX_PLAYERS;a++)e[a].push(t[a])}if(e.M&&(secondTime=!secondTime),e.coordinates){const t=e.coordinates.ball,a={x:t.w,y:t.h,value:1},i=e.coordinates.home,s=e.coordinates.away,r=[],l=[];for(let e=0;e<=MAX_PLAYERS;e++)r.push(null),l.push(null);i.forEach(e=>{if(n=1==e.n?{x:e.w,y:e.h,value:.2}:{x:e.w,y:e.h,value:1},e.n<=MAX_PLAYERS){const t=limitPoint(n,secondTime);if(homePoints[e.n].push(t),homePoints[0].push(t),homeTacticPoints[0].team.push(t),homeTacticPoints[0].averages[e.n].push(t),homePoints[e.n].length>1){const t=homePoints[e.n].length-1;homeMileage[e.n]+=getMileage(homePoints[e.n][t],homePoints[e.n][t-1])}r[e.n]=t}else strangePoints.home.push(e)}),s.forEach(e=>{if(n=1==e.n?{x:e.w,y:e.h,value:.2}:{x:e.w,y:e.h,value:1},e.n<=MAX_PLAYERS){const t=limitPoint(n,!secondTime);if(awayPoints[e.n].push(t),awayPoints[0].push(t),awayTacticPoints[0].team.push(t),awayTacticPoints[0].averages[e.n].push(t),awayPoints[e.n].length>1){const t=awayPoints[e.n].length-1;awayMileage[e.n]+=getMileage(awayPoints[e.n][t],awayPoints[e.n][t-1])}l[e.n]=t}else strangePoints.away.push(e)});const c=limitPoint(a,secondTime);ballPoints.push(c),homeTacticPoints[0].ball.push(c),awayTacticPoints[0].ball.push(c),o(homePointsFull,r),o(awayPointsFull,l)}})}catch(e){console.log("game.forEach ",e)}homeTacticPoints.push(homeTacticPoints[0]),awayTacticPoints.push(awayTacticPoints[0]);const h=c+(s==c?"":`(${function(e,t){const a=e.split(":"),n=t.split(":");return`${n[0]-a[0]}:${n[1]-a[1]}`}(c,s)})`),d=r.date+". "+(r.stadium.city?r.stadium.city+". ":"")+r.stadium.name+". "+r.home.team.name+" - "+r.away.team.name+" "+h;function a(e){return h337.create({container:document.querySelector(e),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS*TEAM_RADIUS_KEFF})}document.querySelector("#game-info").textContent=d,shots.home.forEach(e=>{countShot(e.type,r.home.players[e.player-1])}),shots.away.forEach(e=>{countShot(e.type,r.away.players[e.player-1])});const m=h337.create({container:document.querySelector("#heatmap-home"),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS*TEAM_RADIUS_KEFF}),u=h337.create({container:document.querySelector("#heatmap-away"),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS*TEAM_RADIUS_KEFF}),p=h337.create({container:document.querySelector("#heatmap-ball"),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:.67*POINT_RADIUS}),y=a("#heatmap-avgHome"),g=a("#heatmap-avgAway"),f=a("#chalkboard"),_=a("#heatmap-avgBoth"),v=[{x:19,y:19,value:1,radius:1},{x:346.56,y:229.5,value:200,radius:1},{x:19,y:229.5,value:1,radius:1},{x:346.56,y:19,value:1,radius:1}],x=60,w={max:x*TEAM_MAX_KEFF,data:homePoints[0]},S={max:x*TEAM_MAX_KEFF,data:v};m.setData(w),u.setData({max:x*TEAM_MAX_KEFF,data:awayPoints[0]}),p.setData({max:.33*x,data:ballPoints}),y.setData(S),g.setData(S),f.setData(S),_.setData(S);const P=document.querySelector("#game-info").cloneNode(!0);if(P.id="homeTacticsInfo",P.textContent="Смены тактик "+r.home.team.name,document.body.appendChild(P),homeTacticPoints.length>1)for(let e=1;e<homeTacticPoints.length;e++){if(homeTacticPoints[e].period<MIN_MINUTES_FOR_SHOW_TACTIC)continue;homeTacticPoints[e].averages.forEach((e,t)=>{const a=e.length;0===t||a<2||e.forEach((t,n,o)=>{e[0].x+=t.x/a,e[0].y+=t.y/a})});const t=document.getElementsByClassName("heatmap2-containers-wrapper")[0].cloneNode(!0),n="#heatmap-tactichome"+e,o="#heatmap-ballhome"+e,i=(homeTacticPoints[e].start>0?"от "+homeTacticPoints[e].start:"")+" "+(homeTacticPoints[e].end<125?"до "+homeTacticPoints[e].end:"")+".  "+r.home.team.name;t.querySelector("#heatmap-home").id="heatmap-tactichome"+e,t.querySelector(n+" > div").textContent="Игроки "+i,t.querySelector("#heatmap-away").id="heatmap-ballhome"+e,t.querySelector(o+" > div").textContent="Мяч "+i,document.body.appendChild(t);const s=document.getElementsByClassName("heatmap-container-wrapper-right")[0].cloneNode(!0);s.className="thirdHeatmap",t.className="heatmap3-containers-wrapper",s.querySelector(".heatmap-container").id="avgPositionsHome"+e,s.querySelector(".heatmap-container > div").textContent="Ср.поз."+i,t.appendChild(s);for(let t=1;t<=MAX_PLAYERS;t++){const a=document.querySelector("#player_default_home").cloneNode(!0);a.id="homeAvgPoints_"+e+"_"+t,a.style.display=t<12?"inherit":"none",a.style.left=homeTacticPoints[e].averages[t][0].x-5+"px",a.style.top=homeTacticPoints[e].averages[t][0].y-5+"px",a.querySelector(".player_number").textContent=r.home.players[t-1].number,a.querySelector(".tooltiptext").textContent=r.home.players[t-1].name+"    "+r.home.players[t-1].number,document.querySelector("#avgPositionsHome"+e).appendChild(a)}a("#avgPositionsHome"+e).setData(S),h337.create({container:document.querySelector(n),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS}).setData({max:x,data:homeTacticPoints[e].team}),h337.create({container:document.querySelector(o),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:.67*POINT_RADIUS*1.1}).setData({max:.33*x*.35,data:homeTacticPoints[e].ball})}const T=document.querySelector("#game-info").cloneNode(!0);if(T.id="awayTacticsInfo",T.textContent="Смены тактик "+r.away.team.name,document.body.appendChild(T),awayTacticPoints.length>1)for(let e=1;e<awayTacticPoints.length;e++){if(awayTacticPoints[e].period<MIN_MINUTES_FOR_SHOW_TACTIC)continue;awayTacticPoints[e].averages.forEach((e,t)=>{const a=e.length;0===t||a<2||e.forEach((t,n,o)=>{e[0].x+=t.x/a,e[0].y+=t.y/a})});const t=document.getElementsByClassName("heatmap2-containers-wrapper")[0].cloneNode(!0),a="#heatmap-tacticaway"+e,n="#heatmap-ballaway"+e,o=(awayTacticPoints[e].start>0?"от "+awayTacticPoints[e].start:"")+" "+(awayTacticPoints[e].end<125?"до "+awayTacticPoints[e].end:"")+".  "+r.away.team.name;t.querySelector("#heatmap-home").id="heatmap-tacticaway"+e,t.querySelector(a+" > div").textContent="Игроки "+o,t.querySelector("#heatmap-away").id="heatmap-ballaway"+e,t.querySelector(n+" > div").textContent="Мяч "+o,document.body.appendChild(t);const i=document.getElementsByClassName("heatmap-container-wrapper-right")[0].cloneNode(!0);i.className="thirdHeatmap",t.className="heatmap3-containers-wrapper",i.querySelector(".heatmap-container").id="avgPositionsAway"+e,i.querySelector(".heatmap-container > div").textContent="Ср.поз."+o,t.appendChild(i);for(let t=1;t<=MAX_PLAYERS;t++){const a=document.querySelector("#player_default_away").cloneNode(!0);a.id="awayAvgPoints_"+e+"_"+t,a.style.display=t<12?"inherit":"none",a.style.left=awayTacticPoints[e].averages[t][0].x-5+"px",a.style.top=awayTacticPoints[e].averages[t][0].y-5+"px",a.querySelector(".player_number").textContent=r.away.players[t-1].number,a.querySelector(".tooltiptext").textContent=r.away.players[t-1].name+"    "+r.away.players[t-1].number,document.querySelector("#avgPositionsAway"+e).appendChild(a)}h337.create({container:document.querySelector(a),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS}).setData({max:x,data:awayTacticPoints[e].team}),h337.create({container:document.querySelector(n),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:.67*POINT_RADIUS*1.1}).setData({max:.33*x*.35,data:awayTacticPoints[e].ball})}function n(){const e=document.querySelector("#game-info").cloneNode(!0);e.id="playersHeatmapsInfo",e.textContent="Тепловые карты игроков ",document.body.appendChild(e);for(let e=1;e<=MAX_PLAYERS;e++){const t=document.getElementsByClassName("heatmap2-containers-wrapper")[0].cloneNode(!0),a="#heatmap-home"+e,n="#heatmap-away"+e;t.querySelector("#heatmap-home").id="heatmap-home"+e,t.querySelector(a+" > div").textContent=r.home.players[e-1].number+". "+r.home.players[e-1].name,t.querySelector("#heatmap-away").id="heatmap-away"+e,t.querySelector(n+" > div").textContent=r.away.players[e-1].number+". "+r.away.players[e-1].name,document.body.appendChild(t),h337.create({container:document.querySelector(a),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS}).setData({max:x*TEAM_MAX_KEFF,data:homePoints[e]}),h337.create({container:document.querySelector(n),maxOpacity:MAX_OPACITY,minOpacity:MIN_OPACITY,radius:POINT_RADIUS}).setData({max:x,data:awayPoints[e]})}}function o(e,t,a){const n=e||"home",o=t||1,i=a||homeTacticPoints,s=n+"AvgPoints"+o,r="both"+n+"AvgPoints"+o,l=document.getElementById(s).style,c=document.getElementById(r).style;if(l.display="none"==l.display?"inherit":"none",c.display="none"==c.display?"inherit":"none",i.length>1)for(let e=1;e<i.length;e++){if(i[e].period<MIN_MINUTES_FOR_SHOW_TACTIC)continue;const t=n+"AvgPoints_"+e+"_"+o;document.getElementById(t).style.display="none"==document.getElementById(t).style.display?"inherit":"none"}}function i(){for(let e=1;e<=MAX_PLAYERS;e++){const t=document.querySelector("#player_default_home").cloneNode(!0),a=document.querySelector("#player_default_away").cloneNode(!0);a.id="awayAvgPoints"+e,a.plId="aw"+e,a.style.display=e<12?"inherit":"none",a.style.left=awayAvgPoints[e].x-5+"px",a.style.top=awayAvgPoints[e].y-5+"px";const n="away-player-list_"+e;let i=document.createElement("div");i.className="playerRow",i.id=n;const s=document.createElement("div");s.innerText=r.away.players[e-1].number+". ",s.className="player-list-num";const l=document.createElement("div");l.className="player-list-name";const c=document.createElement("a");c.style.fontWeight=e<12?"bold":"normal",c.id=n+"_name",c.innerText=r.away.players[e-1].name,c.href="#",c.addEventListener("click",(function(e){e.preventDefault(),this.style.fontWeight="bold"==this.style.fontWeight?"normal":"bold",o("away",this.id.replace("away-player-list_","").replace("_name",""),awayTacticPoints)})),r.away.players[e-1].sub&&c.appendChild(getSubArrow(r.away.players[e-1].sub)),l.appendChild(c),i.appendChild(s),i.appendChild(l);const h=document.createElement("div");h.className="player-list-eye",h.innerText=" ",i.appendChild(h);const d=document.createElement("div");d.className="player-list-shots";const m=formShotsString(r.away.players[e-1]);d.innerText=m;const u=document.createElement("div");if(u.className="playerShotCheckbox"," "==m)u.innerText=" ";else{u.appendChild(createShotCheckbox({player:e,team:"away"}));const t=document.createElement("div");t.className="tooltiptext",t.innerText="Удары|В створ|Голы   |Блокированные|Каркас",d.appendChild(t)}i.appendChild(u),i.appendChild(d);const p=document.createElement("div");p.className="player-list-mileage",p.innerText=Number(awayMileage[e]/1e3).toFixed(2)+" км",i.appendChild(p),document.querySelector("#squadAway").appendChild(i),a.querySelector(".player_number").textContent=r.away.players[e-1].number,a.querySelector(".tooltiptext").textContent=r.away.players[e-1].name+"    "+r.away.players[e-1].number,document.getElementById("heatmap-avgAway").appendChild(a);const y=a.cloneNode(!0);y.id="both"+y.id,document.getElementById("heatmap-avgBoth").appendChild(y);const g=a.cloneNode(!0);g.id=g.id+"_individual",document.querySelector("#heatmap-away"+e).appendChild(g),t.id="homeAvgPoints"+e,t.plId="hm"+e,t.style.display=e<12?"inherit":"none",t.style.left=homeAvgPoints[e].x-5+"px",t.style.top=homeAvgPoints[e].y-5+"px";const f="home-player-list_"+e,_=document.createElement("div");_.id=f,_.className="playerRow";const v=document.createElement("div");v.innerText=r.home.players[e-1].number+". ",v.className="player-list-num",_.appendChild(v);const x=document.createElement("div");x.className="player-list-name";const w=document.createElement("a");w.style.fontWeight=e<12?"bold":"normal",w.id=f+"_name",w.innerText=r.home.players[e-1].name,w.href="#",w.addEventListener("click",(function(e){e.preventDefault(),this.style.fontWeight="bold"==this.style.fontWeight?"normal":"bold",o("home",this.id.replace("home-player-list_","").replace("_name",""),homeTacticPoints)})),r.home.players[e-1].sub&&w.appendChild(getSubArrow(r.home.players[e-1].sub)),x.appendChild(w),_.appendChild(x);const S=document.createElement("div");S.className="player-list-eye",S.innerText=" ",_.appendChild(S);const P=document.createElement("div");P.className="player-list-shots";const T=formShotsString(r.home.players[e-1]);P.innerText=T;const C=document.createElement("div");if(C.className="playerShotCheckbox"," "==T)C.innerText=" ";else{C.appendChild(createShotCheckbox({player:e,team:"home"}));const t=document.createElement("div");t.className="tooltiptext",t.innerText="Удары|В створ|Голы   |Блокированные|Каркас",P.appendChild(t)}_.appendChild(C),_.appendChild(P);const A=document.createElement("div");A.className="player-list-mileage",A.innerText=Number(homeMileage[e]/1e3).toFixed(2)+" км",_.appendChild(A),document.querySelector("#squadHome").appendChild(_),t.querySelector(".player_number").textContent=r.home.players[e-1].number,t.querySelector(".tooltiptext").textContent=r.home.players[e-1].name+"    "+r.home.players[e-1].number,document.getElementById("heatmap-avgHome").appendChild(t);const b=t.cloneNode(!0);b.id="both"+b.id,document.getElementById("heatmap-avgBoth").appendChild(b);const E=t.cloneNode(!0);E.id=E.id+"_individual",document.querySelector("#heatmap-home"+e).appendChild(E)}}setTimeout(n,10),document.querySelector("#heatmap-home .overlay").textContent=r.home.team.name,document.querySelector("#heatmap-away .overlay").textContent=r.away.team.name,document.querySelector("#heatmap-avgHome .overlay").textContent="Средние позиции "+r.home.team.name,document.querySelector("#heatmap-avgAway .overlay").textContent="Средние позиции "+r.away.team.name,homeTacticChanges.push(homePoints[0].length-1),awayTacticChanges.push(awayPoints[0].length-1),homePoints.forEach((e,t)=>{const a=e.length;0===t||a<1||e.forEach((e,n)=>{homeAvgPoints[t].x+=e.x/a,homeAvgPoints[t].y+=e.y/a})}),awayPoints.forEach((e,t)=>{const a=e.length;0===t||a<1||e.forEach((e,n)=>{awayAvgPoints[t].x+=e.x/a,awayAvgPoints[t].y+=e.y/a})}),setTimeout(i,200),setTimeout((function(){document.querySelector(".loader-wrapper").remove()}),1e3);const C=document.querySelector("#chalkboard .heatmap-canvas");if(C.getContext){const e=C.getContext("2d");drawTeamShots(shots.away,r.away.players,"away",e),drawTeamShots(shots.home,r.home.players,"home",e)}}else alert("Вставьте верно ссылку на матч!")},e.open("GET",formJsonUrl(tvurl),!0),e.send();const a=document.querySelector("#pasteButton"),n=document.querySelector("#tv-url-input");navigator.clipboard?a.addEventListener("click",e=>{navigator.clipboard.readText().then(e=>{n.value=e}).catch(e=>{console.log("Работа с буфером сейчас не разрешена или не доступна в вашем браузере!")})}):a.remove(),document.querySelector("#updateButton").addEventListener("click",e=>{e.preventDefault(),n.value.match(/http\:\/\/pefl.ru\/tv\/\#\/j\=\d+\&z\=.+/i)?window.location.assign(t(n.value)):alert("Вставьте корректную ссылку на ТВ матча в поле ввода!")}),document.querySelector("#newWindow").addEventListener("click",e=>{e.preventDefault(),n.value.match(/http\:\/\/pefl.ru\/tv\/\#\/j\=\d+\&z\=.+/i)?window.open(t(n.value),"_blank"):alert("Вставьте корректную ссылку на ТВ матча в поле ввода!")})};
//# sourceMappingURL=hm.js.map
